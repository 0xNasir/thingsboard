{
  "widgetsBundle": {
    "alias": "a_general_widgets",
    "title": "A General Widgets",
    "image": null,
    "description": null
  },
  "widgetTypes": [
    {
      "alias": "device_attribute2",
      "name": "Simple Note with Archiver",
      "image": null,
      "description": "Do not need to setup \"Attribute Key\" at the device level. This module will create itself!",
      "descriptor": {
        "type": "latest",
        "sizeX": 9,
        "sizeY": 6.5,
        "resources": [],
        "templateHtml": "<div id=\"pumpStationInfo\">\n    <div class=\"station-info-history\" *ngIf=\"section=='history'\">\n        <table class=\"satl-info-history-table\">\n            <tr>\n                <th>Date</th>\n                <th>Updated by</th>\n                <th>Action</th>\n            </tr>\n            <tr *ngFor=\"let info of deviceInformation\">\n                <td style=\"text-align:center;\">{{info.historyDate|date:'dd-MMM-yyyy'}}</td>\n                <td style=\"text-align:center;\">{{info.updatedBy}}</td>\n                <td style=\"text-align:center;\"><button mat-mini-fab (click)=\"section='form';buildForm(info)\" [style.background-color]=\"settings?.btnbgcolor\" [style.color]=\"settings?.btntxtcolor\"><mat-icon>visibility</mat-icon></button></td>\n            </tr>\n        </table>\n        <button mat-flat-button (click)=\"section='form';buildForm(deviceInformation[deviceInformation.length-1])\" [style.background-color]=\"settings?.btnbgcolor\" [style.color]=\"settings?.btntxtcolor\">Latest information</button>\n    </div>\n    \n    <form action=\"\" method=\"POST\" *ngIf=\"form&&section=='form'\" [formGroup]=\"form\" accept-charset=\"utf-8\" class=\"satl-device-info-form\" (submit)=\"saveInformation()\">\n        <table class=\"satl-device-info-form-table\">\n            <thead>\n                <tr>\n                <th style=\"text-align:left;\">Updated:<span *ngIf=\"deviceInformation.length\"> {{deviceInformation[deviceInformation.length-1].historyDate|date:'dd-MMM-yyyy'}}</span></th>\n                <td style=\"text-align:right;\"><button mat-mini-fab color=\"primary\" type=\"button\" style=\"margin:10px;\" (click)=\"section='history'\" [style.background-color]=\"settings?.btnbgcolor\" [style.color]=\"settings?.btntxtcolor\"><mat-icon>history</mat-icon></button><button mat-mini-fab color=\"accent\" style=\"margin:10px;\" [style.background-color]=\"settings?.btnbgcolor\" [style.color]=\"settings?.btntxtcolor\"><mat-icon>save</mat-icon></button></td>\n            </tr>\n            </thead>\n            <tbody>\n                <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Scada start date</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput [matDatepicker]=\"startPicker\" (click)=\"openDatePicker(startPicker)\" formControlName=\"startDate\">\n                      <mat-datepicker-toggle matSuffix [for]=\"startPicker\"></mat-datepicker-toggle>\n                      <mat-datepicker #startPicker></mat-datepicker>\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" class=\"header\" style=\"text-align:right;\" [style.background-color]=\"settings?.sectionHeaderBgColor\" [style.color]=\"settings?.sectionHeaderTxtColor\" [style.border-color]=\"settings?.borderColor\">\n                    <div class=\"header-txt\">WELL DATA</div></td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Commissioning date</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput [matDatepicker]=\"comPicker\" (click)=\"openDatePicker(comPicker)\" formControlName=\"commissioningDate\">\n                      <mat-datepicker-toggle matSuffix [for]=\"comPicker\"></mat-datepicker-toggle>\n                      <mat-datepicker #comPicker></mat-datepicker>\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Housing length</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"housingLength\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Fixture length</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"fixtureLength\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Strainer length</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"strainerLength\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Number of column pipe</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"numberOfColumnPipe\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" class=\"header\" style=\"text-align:right;\" [style.background-color]=\"settings?.sectionHeaderBgColor\" [style.color]=\"settings?.sectionHeaderTxtColor\" [style.border-color]=\"settings?.borderColor\">\n                    <div class=\"header-txt\">MOTOR DATA</div></td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Voltage</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"voltage\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>AMP</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"amp\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>RPM</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"rpm\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Power</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"power\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" class=\"header\" style=\"text-align:right;\" [style.background-color]=\"settings?.sectionHeaderBgColor\" [style.color]=\"settings?.sectionHeaderTxtColor\" [style.border-color]=\"settings?.borderColor\">\n                    <div class=\"header-txt\">PUMP DATA</div></td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Head</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"head\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Cusec</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"cusec\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td colspan=\"2\" class=\"header\" style=\"text-align:right;\" [style.background-color]=\"settings?.sectionHeaderBgColor\" [style.color]=\"settings?.sectionHeaderTxtColor\" [style.border-color]=\"settings?.borderColor\">\n                    <div class=\"header-txt\">CALIBRATION</div></td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Energy meter reading</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"energyMeterReading\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            <tr>\n                <td [style.border-color]=\"settings?.borderColor\"><mat-label>Flow meter reading</mat-label></td>\n                <td [style.border-color]=\"settings?.borderColor\">\n                    <mat-form-field class=\"example-full-width\" appearance=\"outline\">\n                    <input matInput type=\"number\" formControlName=\"flowMeterReading\">\n                    </mat-form-field>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n    </form>\n</div>",
        "templateCss": "#pumpStationInfo{\n    height: 100%;\n    width: 100%;\n    overflow: auto;\n}\n\n#pumpStationInfo::-webkit-scrollbar {\n  width: 11px;\n}\n#pumpStationInfo {\n  scrollbar-width: thin;\n  scrollbar-color: #90A4AE #CFD8DC;\n}\n#pumpStationInfo::-webkit-scrollbar-track {\n  background: #CFD8DC;\n}\n#pumpStationInfo::-webkit-scrollbar-thumb {\n  background-color: #90A4AE ;\n  border-radius: 6px;\n  border: 3px solid #CFD8DC;\n}\n\n/*Main css start for this widget*/\ntable.satl-device-info-form-table,\ntable.satl-info-history-table{\n    border-collapse: collapse;\n    width: 100%;\n}\n\ntable.satl-device-info-form-table tr td{\n    width: 50%;\n}\ntable.satl-info-history-table tr td{\n    width: 33.33%;\n}\ntable.satl-device-info-form-table tr td div.header-txt{\n    padding: 5px 10px;\n}\ntable.satl-device-info-form-table tbody tr td{\n    border:0.5px solid;\n}\n.satl-device-info-form table.satl-device-info-form-table tr td mat-form-field{\n    width: 100%;\n}\n.satl-device-info-form table.satl-device-info-form-table tr td mat-form-field, .satl-device-info-form table.satl-device-info-form-table tr td mat-label{\n    padding: 0px 5px;\n}\n\n/* Angular Material Overrides */\n.mat-form-field-appearance-outline .mat-form-field-outline {\n  color: #ccc; /* Override outline color. */\n}\nmat-datepicker-toggle button.mat-focus-indicator.mat-icon-button.mat-button-base {\n    color: rgb(108 108 108);\n}\n\n.satl-device-info-form table.satl-device-info-form-table .mat-form-field-appearance-outline .mat-form-field-infix {\n  padding: .4em 0; /* Original top/bottom value was 1em. */\n}\n\n\n.mat-input-element {\n  position: relative;\n  top:  -0.2em; /* Adjust accordingly to keep placeholder/input text vertically centered. */\n}\n.mat-form-field-wrapper {\n    padding-bottom: 0px;\n}\n",
        "controllerScript": "self.onInit = function() {\n    $scope=self.ctx.$scope;\n    $scope.settings=self.ctx.settings;\n    $scope.section='form';\n    var decoded = JSON.parse(atob(localStorage.getItem('jwt_token').split('.')[1]));\n    var userFullName = decoded.firstName + \" \" + decoded.lastName;\n    $scope.deviceInformation=[];\n    data=self.ctx.defaultSubscription.data[0]\n    self.ctx.getWidgetPositions = function(){\n        let pathNames = window.location.pathname.split(\"/\");\n        return {\n            isInWidgetEditor: pathNames.includes(\"widget-editor\"),\n            isInWidgetBundle: pathNames.includes(\"widgets-bundles\"),\n            isInDashboard: pathNames.includes(\"dashboards\"),\n            isInDashboardEditor: self.ctx.isEdit\n        }\n    }\n    $scope.buildForm=function(data){\n       $scope.form=$scope.fb.group({\n            startDate:[data?.startDate, $scope.validators.required],\n            commissioningDate:[data?.commissioningDate, $scope.validators.required],\n            housingLength:[data?.housingLength],\n            fixtureLength:[data?.fixtureLength],\n            strainerLength:[data?.strainerLength],\n            numberOfColumnPipe:[data?.numberOfColumnPipe],\n            voltage:[data?.voltage],\n            amp:[data?.amp],\n            rpm:[data?.rpm],\n            power:[data?.power],\n            head:[data?.head],\n            cusec:[data?.cusec],\n            energyMeterReading:[data?.energyMeterReading],\n            flowMeterReading:[data?.flowMeterReading],\n            historyDate:[data?.historyDate]\n        }); \n        self.ctx.detectChanges();\n    }\n    let gwp=self.ctx.getWidgetPositions();\n    if(!gwp.isInWidgetBundle){\n        self.ctx.attributeService.getEntityAttributes(data.datasource.entity.id, 'SERVER_SCOPE', [$scope.settings.attributeName]).subscribe(function(data){\n            if(data.length>0){\n                $scope.deviceInformation=data[0].value;\n                data=data[0].value[data[0].value.length-1];\n                $scope.buildForm(data);\n            }else{\n                $scope.buildForm({});\n            }\n        }, error=>{\n            $scope.buildForm({});\n        });\n    }else{\n        $scope.buildForm({});\n    }\n    self.ctx.$scope.openDatePicker=function(dp) {\n        dp.open();\n    }\n    $scope.saveInformation=function(){\n        if ($scope.form.valid) {\n            \n            if($scope.deviceInformation.length&&$scope.deviceInformation.length){\n                infos=$scope.deviceInformation;\n                i=-1;\n                index=null;\n                infos.forEach(info=>{\n                    i++;\n                    if(moment(info.historyDate).format('DD-MM-YYYY')==moment(new Date()).format('DD-MM-YYYY')){\n                        index=i;\n                    }\n                })\n                if(index!=null&&index<infos.length){\n                    $scope.deviceInformation.splice(index,1);\n                }\n            }\n            $scope.form.value.historyDate=new Date();\n            $scope.form.value.updatedBy=userFullName;\n            $scope.deviceInformation.push($scope.form.value);\n            self.ctx.attributeService.saveEntityAttributes(\n            data.datasource.entity.id, 'SERVER_SCOPE', [{key:$scope.ctx.settings.attributeName, value:$scope.deviceInformation}]).subscribe(function(e){\n                self.onInit();\n                self.ctx.showToast('success', 'Device information is saved successfully', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n            });\n        }\n    }\n    \n}\n",
        "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"required\": [\n            \"attributeName\"\n        ],\n        \"properties\": {\n            \"borderColor\": {\n                \"title\": \"Border color\",\n                \"type\": \"string\"\n            },\n            \"btnbgcolor\": {\n                \"title\": \"Button background color\",\n                \"type\": \"string\"\n            },\n            \"btntxtcolor\": {\n                \"title\": \"Button text color\",\n                \"type\": \"string\"\n            },\n            \"sectionHeaderBgColor\": {\n                \"title\": \"Section header background color\",\n                \"type\": \"string\"\n            },\n            \"sectionHeaderTxtColor\": {\n                \"title\": \"Section header text color\",\n                \"type\": \"string\"\n            },\n            \"attributeName\": {\n                \"title\": \"Attribute key\",\n                \"type\": \"string\",\n                \"default\": \"stationInfo\"\n            }\n        }\n    },\n    \"form\": [{\n        \"key\": \"borderColor\",\n        \"type\": \"color\"\n    },{\n        \"key\": \"btnbgcolor\",\n        \"type\": \"color\"\n    },{\n        \"key\": \"btntxtcolor\",\n        \"type\": \"color\"\n    },{\n        \"key\": \"sectionHeaderBgColor\",\n        \"type\": \"color\"\n    },{\n        \"key\": \"sectionHeaderTxtColor\",\n        \"type\": \"color\"\n    },\n    {\n        \"key\": \"attributeName\",\n        \"type\": \"text\"\n    }]\n}",
        "dataKeySettingsSchema": "{}\n",
        "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#282525\",\"color\":\"rgba(238,223,223,0.87)\",\"padding\":\"8px\",\"settings\":{\"btnbgcolor\":\"#e6049f\",\"btntxtcolor\":\"#ffffff\",\"attributeName\":\"stationInfo\",\"enableModule\":false},\"title\":\"Simple Note with Archiver\",\"showTitleIcon\":false,\"iconColor\":\"rgba(0, 0, 0, 0.87)\",\"iconSize\":\"24px\",\"titleTooltip\":\"\",\"dropShadow\":true,\"enableFullscreen\":true,\"widgetStyle\":{},\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"showLegend\":false}"
      }
    }
  ]
}