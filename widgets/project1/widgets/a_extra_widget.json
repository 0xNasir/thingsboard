{
  "widgetsBundle": {
    "alias": "a_extra_widget",
    "title": "A Extra widget",
    "image": null,
    "description": null
  },
  "widgetTypes": [
    {
      "alias": "motorcontrol2",
      "name": "Simple RPC analog value set",
      "image": null,
      "description": null,
      "descriptor": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 2,
        "resources": [],
        "templateHtml": "<div class=\"flexContainer\">\n    <div [style.color]=\"settings?.titleColor\" style=\"line-height: 40px; font-size: 20px; flex-grow: 1;\">{{settings?.valueTitle}}</div>\n    <input #analogValue style=\"width: 100px; height:35px;\" type=\"number\" [min]=\"settings?.minValue\" [max]=\"settings?.maxValue\" [(value)]=\"alalogValue\">\n    <button mat-mini-fab [class]=\"isRpcRunning?'satl-spinner':''\" [disabled]=\"isRpcRunning\" [style.background-color]=\"analogValue.value==alalogValue?settings?.buttonSyncedBgColor:settings?.buttonBgColor\" [style.color]=\"settings?.buttonTxColor\" (click)=\"setToDevice(analogValue.value)\"><mat-icon *ngIf=\"analogValue.value==alalogValue\">check</mat-icon><mat-icon *ngIf=\"analogValue.value!=alalogValue\">file_upload</mat-icon></button>\n</div>",
        "templateCss": ".flexContainer{\n    display: flex;\n    gap: 10px;\n    height: 100%;\n    align-items: center;\n    padding-left: 8px;\n    padding-right: 8px;\n}\n\n/*Animation for spinner on button*/\n@keyframes spinner {\n  to {transform: rotate(360deg);}\n}\n\n.satl-spinner:before {\n  content: '';\n  box-sizing: border-box;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 20px;\n  height: 20px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 2px solid #ffffff;\n  border-top-color: #000000;\n  animation: spinner .8s linear infinite;\n}\n\nbutton.mat-button-disabled mat-icon {\n    opacity: 0;\n}",
        "controllerScript": "self.onInit = function() {\n    self.ctx.updateCounter = 0;\n    let settings = self.ctx.settings;\n    self.ctx.$scope.settings = settings;\n    self.ctx.$scope.alalogValue = 0;\n    self.ctx.$scope.isRpcRunning = false;\n    \n    self.ctx.detectChanges();\n    \n    let deviceId = self.ctx.defaultSubscription.datasources[0].entityId;\n    let deviceService = self.ctx.deviceService;\n    \n    \n    //deviceService.sendTwoWayRpcCommand(deviceId, {method: 'getFrequency',params: 0}).subscribe(function(r){\n    //    self.ctx.$scope.frequency = r;\n    //});\n    \n    self.ctx.$scope.setToDevice = function(v){\n        \n        if(self.ctx.$scope.alalogValue == v){\n            self.ctx.showToast('warn', settings.valueTitle + ' not changed!', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n        }else{\n            if(v>=settings.minValue && v<=settings.maxValue){\n                self.ctx.$scope.isRpcRunning = true;\n                self.ctx.$scope.alalogValue = v;\n                //self.ctx.detectChanges();\n                //console.log(v);\n                \n                var requestBody = {\n                    method: settings.rpcMethod,\n                    params: {\n                        value: parseFloat(v * settings.rpcParamsValueMultiplier),\n                        datatype: settings.rpcParamsValueDatatype\n                    }\n                };\n                \n                console.log(requestBody);\n                \n                deviceService.sendTwoWayRpcCommand(deviceId, requestBody, 500).subscribe(function(e){\n                    self.ctx.$scope.isRpcRunning = false;\n                    self.ctx.showToast('success', settings.valueTitle + ' updated!', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n                    //console.log('set frequency seccess');\n                    //console.log(e);\n                },function(f){\n                    self.ctx.$scope.isRpcRunning = false;\n                    //console.log(f);\n                    //console.log(\"backend is not responding\");\n                    self.ctx.showToast('error', settings.valueTitle + ' failed to update!', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n                });\n            } else {\n                self.ctx.showToast('warn', settings.valueTitle + ' out of range! Expected between ' + settings.minValue + ' to ' + settings.maxValue, 4000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n            }\n        }\n        \n        \n    }\n\n}\n\nself.onDataUpdated = function() {\n    \n    let myData = self.ctx.data[0];\n    // console.log(myData);\n    \n    if (myData && myData.data && myData.data.length > 0) {\n        console.log(\"level One\");\n        if(self.ctx.$scope.alalogValue !== myData.data[0][1]){\n            console.log(\"inside condition\");\n            self.ctx.$scope.alalogValue = Number(myData.data[0][1]);\n        }\n        self.ctx.detectChanges();\n        \n        /*self.ctx.updateCounter++;\n        if(self.ctx.updateCounter == 1){\n            self.ctx.$scope.alalogValue = myData.data[0][1];\n            self.ctx.detectChanges();\n        }*/\n         //console.log(myData);\n        //self.ctx.$scope.dynamicValus[0].currentFrequency = myData.data[0][1];\n        //self.ctx.$scope.dynamicValus[0].targetFrequency = myData.data[0][1];\n        //$(\"#currentFrequency\").text(myData.data[0][1]);\n        \n    }\n}\n\n\nself.typeParameters = function() {\n    return {\n        maxDatasources: 1,\n        maxDataKeys: 1,\n        singleEntity: true\n    };\n};\n\n\nself.onDestroy = function() {\n}\n",
        "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"required\": [],\n        \"properties\": {\n            \"valueTitle\": {\n                \"title\": \"Value title\",\n                \"type\": \"string\",\n                \"default\": \"Analog value\"\n            },\n            \"titleColor\": {\n                \"title\": \"Title color\",\n                \"type\": \"string\"\n            },\n            \"minValue\": {\n                \"title\": \"Minimum value\",\n                \"type\": \"number\",\n                \"default\": 0\n            },\n            \"maxValue\": {\n                \"title\": \"Maximum value\",\n                \"type\": \"number\",\n                \"default\": 100\n            },\n            \"buttonSyncedBgColor\": {\n                \"title\": \"Button synced background color\",\n                \"type\": \"string\"\n            },\n            \"buttonBgColor\": {\n                \"title\": \"Button background color\",\n                \"type\": \"string\"\n            },\n            \"buttonTxColor\": {\n                \"title\": \"Button text color\",\n                \"type\": \"string\"\n            },\n            \"rpcMethod\": {\n                \"title\": \"RPC Method\",\n                \"type\": \"string\",\n                \"default\": \"analogValueMethod\"\n            },\n            \"rpcParamsValueMultiplier\": {\n                \"title\": \"RPC params value multiplier\",\n                \"type\": \"number\",\n                \"default\": 1\n            },\n            \"rpcParamsValueDatatype\": {\n                \"title\": \"RPC params value Datatype\",\n                \"type\": \"string\",\n                \"default\": \"Float\"\n            }\n        }\n    },\n    \"form\": [\n        {\n            \"key\": \"valueTitle\",\n            \"type\": \"text\"\n        },\n        {\n            \"key\": \"titleColor\",\n            \"type\": \"color\"\n        },\n        {\n            \"key\": \"minValue\",\n            \"type\": \"number\"\n        },\n        {\n            \"key\": \"maxValue\",\n            \"type\": \"number\"\n        },\n        {\n            \"key\": \"buttonSyncedBgColor\",\n            \"type\": \"color\"\n        },\n        {\n            \"key\": \"buttonBgColor\",\n            \"type\": \"color\"\n        },\n        {\n            \"key\": \"buttonTxColor\",\n            \"type\": \"color\"\n        },\n        {\n            \"key\": \"rpcMethod\",\n            \"type\": \"text\"\n        },\n        {\n            \"key\": \"rpcParamsValueMultiplier\",\n            \"type\": \"number\"\n        },\n        {\n            \"key\": \"rpcParamsValueDatatype\",\n            \"type\": \"text\"\n        }\n    ]\n}",
        "dataKeySettingsSchema": "{}\n",
        "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"0\",\"settings\":{\"valueTitle\":\"Analog value\",\"minValue\":0,\"maxValue\":100,\"titleColor\":\"#111111\",\"buttonBgColor\":\"#ff0000\",\"buttonTxColor\":\"#ffffff\",\"rpcMethod\":\"analogValueMethod\",\"rpcParamsValueMultiplier\":1,\"buttonSyncedBgColor\":\"#00c60b\"},\"title\":\"Simple RPC analog value set\",\"showTitleIcon\":false,\"iconColor\":\"rgba(0, 0, 0, 0.87)\",\"iconSize\":\"24px\",\"titleTooltip\":\"\",\"dropShadow\":true,\"enableFullscreen\":false,\"widgetStyle\":{},\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"showLegend\":false}"
      }
    },
    {
      "alias": "digital_value_on_off_type",
      "name": "Digital value RPC On Off type",
      "image": null,
      "description": null,
      "descriptor": {
        "type": "latest",
        "sizeX": 8.5,
        "sizeY": 2,
        "resources": [],
        "templateHtml": "<div class=\"flexContainer\">\n    <div [style.color]=\"settings?.titleColor\" style=\"line-height: 40px; font-size: 20px; flex-grow: 1;\">{{settings?.valueTitle}}</div>\n    <div class=\"statusBox\">{{displayValue}}</div>\n    <button mat-icon-button [class]=\"isRpcRunning?'satl-spinner':''\" [disabled]=\"isRpcRunning\" [style.background-color]=\"settings?.buttonBgColor\" [style.color]=\"settings?.buttonTxColor\" (click)=\"setToDevice()\"><mat-icon>loop</mat-icon></button>\n</div>",
        "templateCss": ".flexContainer{\n    display: flex;\n    gap: 10px;\n    height: 100%;\n    align-items: center;\n    padding-left: 8px;\n    padding-right: 8px;\n}\n\n.statusBox{\n    width: 130px;\n    height: 35px;\n    border: 1px solid #777777;\n    font-size: 18px;\n    line-height: 30px;\n    padding: 2px;\n    background-color: white;\n    color: black;\n}\n\n\n/*Animation for spinner on button*/\n@keyframes spinner {\n  to {transform: rotate(360deg);}\n}\n\n.satl-spinner:before {\n  content: '';\n  box-sizing: border-box;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 20px;\n  height: 20px;\n  margin-top: -10px;\n  margin-left: -10px;\n  border-radius: 50%;\n  border: 2px solid #ffffff;\n  border-top-color: #000000;\n  animation: spinner .8s linear infinite;\n}\n\nbutton.mat-button-disabled mat-icon {\n    opacity: 0;\n}",
        "controllerScript": "self.onInit = function() {\n    self.ctx.updateCounter = 0;\n    let settings = self.ctx.settings;\n    self.ctx.$scope.settings = settings;\n    self.ctx.$scope.digitalValue = undefined;\n    self.ctx.$scope.displayValue = 'Indeterminate';\n    self.ctx.$scope.isRpcRunning = false;\n    self.ctx.updateDisplayValue = function(){\n        if(self.ctx.$scope.digitalValue){\n            self.ctx.$scope.displayValue = self.ctx.settings.trueText;\n        } else {\n            self.ctx.$scope.displayValue = self.ctx.settings.falseText;\n        }\n        self.ctx.detectChanges();\n    };\n    \n    self.ctx.detectChanges();\n    \n    let deviceId = self.ctx.defaultSubscription.datasources[0].entityId;\n    let deviceService = self.ctx.deviceService;\n    \n    \n    //deviceService.sendTwoWayRpcCommand(deviceId, {method: 'getFrequency',params: 0}).subscribe(function(r){\n    //    self.ctx.$scope.frequency = r;\n    //});\n    \n    self.ctx.$scope.setToDevice = function(){\n        if(self.ctx.$scope.digitalValue !== undefined){\n            var requestBody = {\n                method: settings.rpcMethod,\n                params: {\n                    value: !self.ctx.$scope.digitalValue,\n                    datatype: \"Boolean\"\n                }\n            };\n            deviceService.sendTwoWayRpcCommand(deviceId, requestBody, 500).subscribe(function(e){\n                self.ctx.$scope.isRpcRunning = false;\n                //self.ctx.$scope.digitalValue = !self.ctx.$scope.digitalValue;\n                //self.ctx.updateDisplayValue();\n                self.ctx.showToast('success', settings.valueTitle + ' status updated!', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n                //console.log(e);\n            },function(f){\n                self.ctx.$scope.isRpcRunning = false;\n                self.ctx.detectChanges();\n                self.ctx.showToast('error', settings.valueTitle + ' status update failed!', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n            });\n            \n            self.ctx.$scope.isRpcRunning = true;\n            self.ctx.detectChanges();\n        } else {\n            self.ctx.showToast('warn', settings.valueTitle + ' indeterminate!', 4000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n        }\n    }\n\n}\n\nself.onDataUpdated = function() {\n    \n    let myData = self.ctx.data[0];\n    \n    if (myData && myData.data && myData.data.length > 0) {\n        let v = myData.data[0][1];\n        if(v == 'true' || v == true || v>=1){\n            self.ctx.$scope.digitalValue = true;\n        } else {\n            self.ctx.$scope.digitalValue = false;\n        }\n        self.ctx.updateDisplayValue();\n    }\n}\n\nself.typeParameters = function() {\n    return {\n        maxDatasources: 1,\n        maxDataKeys: 1,\n        singleEntity: true\n    };\n};\n\nself.onDestroy = function() {\n}\n",
        "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"required\": [],\n        \"properties\": {\n            \"valueTitle\": {\n                \"title\": \"Value title\",\n                \"type\": \"string\",\n                \"default\": \"Digital value\"\n            },\n            \"titleColor\": {\n                \"title\": \"Title color\",\n                \"type\": \"string\"\n            },\n            \"trueText\": {\n                \"title\": \"True Text\",\n                \"type\": \"string\",\n                \"default\": \"True Text\"\n            },\n            \"falseText\": {\n                \"title\": \"False Text\",\n                \"type\": \"string\",\n                \"default\": \"False Text\"\n            },\n            \"buttonBgColor\": {\n                \"title\": \"Button background color\",\n                \"type\": \"string\"\n            },\n            \"buttonTxColor\": {\n                \"title\": \"Button text color\",\n                \"type\": \"string\"\n            },\n            \"rpcMethod\": {\n                \"title\": \"RPC Method\",\n                \"type\": \"string\",\n                \"default\": \"analogValueMethod\"\n            }\n        }\n    },\n    \"form\": [\n        {\n            \"key\": \"valueTitle\",\n            \"type\": \"text\"\n        },\n        {\n            \"key\": \"titleColor\",\n            \"type\": \"color\"\n        },\n        {\n            \"key\": \"trueText\",\n            \"type\": \"text\"\n        },\n        {\n            \"key\": \"falseText\",\n            \"type\": \"text\"\n        },\n        {\n            \"key\": \"buttonBgColor\",\n            \"type\": \"color\"\n        },\n        {\n            \"key\": \"buttonTxColor\",\n            \"type\": \"color\"\n        },\n        {\n            \"key\": \"rpcMethod\",\n            \"type\": \"text\"\n        }\n    ]\n}",
        "dataKeySettingsSchema": "{}\n",
        "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"entityAliasId\":null,\"filterId\":null,\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = Math.random()>=0.5?true:\\\"false\\\";\\nreturn value;\",\"units\":null,\"decimals\":null,\"usePostProcessing\":null,\"postFuncBody\":null}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"0\",\"settings\":{\"valueTitle\":\"Digital value\",\"titleColor\":\"#111111\",\"buttonBgColor\":\"#ff0000\",\"buttonTxColor\":\"#ffffff\",\"rpcMethod\":\"analogValueMethod\",\"trueText\":\"True Text\",\"falseText\":\"False Text\"},\"title\":\"Digital value RPC On Off type\",\"showTitleIcon\":false,\"iconColor\":\"rgba(0, 0, 0, 0.87)\",\"iconSize\":\"24px\",\"titleTooltip\":\"\",\"dropShadow\":true,\"enableFullscreen\":false,\"widgetStyle\":{\"cursor\":\"default\"},\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"showLegend\":false}"
      }
    },
    {
      "alias": "device_attribute22",
      "name": "Simple Note with Archiver",
      "image": null,
      "description": "Do not need to setup \"Attribute Key\" at the device level. This module will create itself!",
      "descriptor": {
        "type": "latest",
        "sizeX": 9,
        "sizeY": 6.5,
        "resources": [],
        "templateHtml": "<div id=\"pumpStationInfo\">\n    <div class=\"station-info-history\" *ngIf=\"section=='history'\">\n        <table class=\"satl-info-history-table\">\n            <tr>\n                <th>Date</th>\n                <th>Updated by</th>\n                <th>Action</th>\n            </tr>\n            <tr *ngFor=\"let info of deviceInformation\">\n                <td style=\"text-align:center;\">{{info.historyDate|date:'dd-MMM-yyyy'}}</td>\n                <td style=\"text-align:center;\">{{info.updatedBy}}</td>\n                <td style=\"text-align:center;\"><button mat-mini-fab (click)=\"section='form';buildForm(info)\" [style.background-color]=\"settings?.btnbgcolor\" [style.color]=\"settings?.btntxtcolor\"><mat-icon>visibility</mat-icon></button></td>\n            </tr>\n        </table>\n        <button mat-flat-button (click)=\"section='form';buildForm(deviceInformation[deviceInformation.length-1])\" [style.background-color]=\"settings?.btnbgcolor\" [style.color]=\"settings?.btntxtcolor\">Latest information</button>\n    </div>\n    \n    <form action=\"\" method=\"POST\" *ngIf=\"form&&section=='form'\" [formGroup]=\"form\" accept-charset=\"utf-8\" class=\"satl-device-info-form\" (submit)=\"saveInformation()\">\n        <table class=\"satl-device-info-form-table\">\n            <thead>\n                <tr>\n                <th style=\"text-align:left;\">Updated:<span *ngIf=\"deviceInformation.length\"> {{deviceInformation[deviceInformation.length-1].historyDate|date:'dd-MMM-yyyy'}}</span></th>\n                <td style=\"text-align:right;\"><button mat-mini-fab color=\"primary\" type=\"button\" style=\"margin:10px;\" (click)=\"section='history'\" [style.background-color]=\"settings?.btnbgcolor\" [style.color]=\"settings?.btntxtcolor\"><mat-icon>history</mat-icon></button><button mat-mini-fab color=\"accent\" style=\"margin:10px;\" [style.background-color]=\"settings?.btnbgcolor\" [style.color]=\"settings?.btntxtcolor\"><mat-icon>save</mat-icon></button></td>\n            </tr>\n            </thead>\n        </table>\n        <mat-form-field style=\"width: 100%;\" appearance=\"outline\">\n            <mat-label [style.color]=\"color\">Description</mat-label>\n            <textarea matInput [rows]='rows' formControlName=\"note\">\n            </textarea>\n        </mat-form-field>\n    </form>\n</div>",
        "templateCss": "#pumpStationInfo{\n    height: 100%;\n    width: 100%;\n    overflow: auto;\n}\n\n#pumpStationInfo::-webkit-scrollbar {\n  width: 11px;\n}\n#pumpStationInfo {\n  scrollbar-width: thin;\n  scrollbar-color: #90A4AE #CFD8DC;\n}\n#pumpStationInfo::-webkit-scrollbar-track {\n  background: #CFD8DC;\n}\n#pumpStationInfo::-webkit-scrollbar-thumb {\n  background-color: #90A4AE ;\n  border-radius: 6px;\n  border: 3px solid #CFD8DC;\n}\n\n/*Main css start for this widget*/\ntable.satl-device-info-form-table,\ntable.satl-info-history-table{\n    border-collapse: collapse;\n    width: 100%;\n}\n\ntable.satl-device-info-form-table tr td{\n    width: 50%;\n}\ntable.satl-info-history-table tr td{\n    width: 33.33%;\n}\ntable.satl-device-info-form-table tr td div.header-txt{\n    padding: 5px 10px;\n}\ntable.satl-device-info-form-table tbody tr td{\n    border:0.5px solid;\n}\n.satl-device-info-form table.satl-device-info-form-table tr td mat-form-field{\n    width: 100%;\n}\n.satl-device-info-form table.satl-device-info-form-table tr td mat-form-field, .satl-device-info-form table.satl-device-info-form-table tr td mat-label{\n    padding: 0px 5px;\n}\n\n/* Angular Material Overrides */\n.mat-form-field-appearance-outline .mat-form-field-outline {\n  color: #ccc; /* Override outline color. */\n}\nmat-datepicker-toggle button.mat-focus-indicator.mat-icon-button.mat-button-base {\n    color: rgb(108 108 108);\n}\n\n.satl-device-info-form table.satl-device-info-form-table .mat-form-field-appearance-outline .mat-form-field-infix {\n  padding: .4em 0; /* Original top/bottom value was 1em. */\n}\n\n\n.mat-input-element {\n  position: relative;\n  top:  -0.2em; /* Adjust accordingly to keep placeholder/input text vertically centered. */\n}\n.mat-form-field-wrapper {\n    padding-bottom: 0px;\n}\n",
        "controllerScript": "self.onInit = function() {\n    $scope=self.ctx.$scope;\n    $scope.settings=self.ctx.settings;\n    $scope.color=self.ctx.widgetConfig.color;\n    $scope.section='form';\n    var decoded = JSON.parse(atob(localStorage.getItem('jwt_token').split('.')[1]));\n    var userFullName = decoded.firstName + \" \" + decoded.lastName;\n    $scope.deviceInformation=[];\n    \n    data=self.ctx.defaultSubscription.data[0]\n    self.ctx.getWidgetPositions = function(){\n        let pathNames = window.location.pathname.split(\"/\");\n        return {\n            isInWidgetEditor: pathNames.includes(\"widget-editor\"),\n            isInWidgetBundle: pathNames.includes(\"widgets-bundles\"),\n            isInDashboard: pathNames.includes(\"dashboards\"),\n            isInDashboardEditor: self.ctx.isEdit\n        }\n    }\n    $scope.buildForm=function(data){\n       $scope.form=$scope.fb.group({\n            note:[data?.note, $scope.validators.required],\n        }); \n        self.ctx.detectChanges();\n    }\n    let gwp=self.ctx.getWidgetPositions();\n    if(!gwp.isInWidgetBundle){\n        self.ctx.attributeService.getEntityAttributes(data.datasource.entity.id, 'SERVER_SCOPE', [$scope.settings.attributeName]).subscribe(function(data){\n            if(data.length>0){\n                $scope.deviceInformation=data[0].value;\n                data=data[0].value[data[0].value.length-1];\n                $scope.buildForm(data);\n            }else{\n                $scope.buildForm({});\n            }\n        }, error=>{\n            $scope.buildForm({});\n        });\n    }else{\n        $scope.buildForm({});\n    }\n    self.ctx.$scope.openDatePicker=function(dp) {\n        dp.open();\n    }\n    $scope.saveInformation=function(){\n        if ($scope.form.valid) {\n            \n            if($scope.deviceInformation.length&&$scope.deviceInformation.length){\n                infos=$scope.deviceInformation;\n                i=-1;\n                index=null;\n                infos.forEach(info=>{\n                    i++;\n                    if(moment(info.historyDate).format('DD-MM-YYYY')==moment(new Date()).format('DD-MM-YYYY')){\n                        index=i;\n                    }\n                })\n                if(index!=null&&index<infos.length){\n                    $scope.deviceInformation.splice(index,1);\n                }\n            }\n            $scope.form.value.historyDate=new Date();\n            $scope.form.value.updatedBy=userFullName;\n            $scope.deviceInformation.push($scope.form.value);\n            self.ctx.attributeService.saveEntityAttributes(\n            data.datasource.entity.id, 'SERVER_SCOPE', [{key:$scope.ctx.settings.attributeName, value:$scope.deviceInformation}]).subscribe(function(e){\n                self.onInit();\n                self.ctx.showToast('success', 'Saved successfully', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n            });\n        }else{\n            self.ctx.showToast('error', 'Invalid input', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n        }\n    }\n    self.onResize();\n}\nself.onResize=function(){\n    let $scope=self.ctx.$scope;\n    $scope.rows=Math.floor((self.ctx.height-90)/20);\n    console.log(self.ctx.height)\n}\n",
        "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"required\": [\n            \"attributeName\"\n        ],\n        \"properties\": {\n            \"btnbgcolor\": {\n                \"title\": \"Button background color\",\n                \"type\": \"string\"\n            },\n            \"btntxtcolor\": {\n                \"title\": \"Button text color\",\n                \"type\": \"string\"\n            },\n            \"attributeName\": {\n                \"title\": \"Attribute key\",\n                \"type\": \"string\",\n                \"default\": \"note\"\n            }\n        }\n    },\n    \"form\": [{\n        \"key\": \"btnbgcolor\",\n        \"type\": \"color\"\n    },{\n        \"key\": \"btntxtcolor\",\n        \"type\": \"color\"\n    },\n    {\n        \"key\": \"attributeName\",\n        \"type\": \"text\"\n    }]\n}",
        "dataKeySettingsSchema": "{}\n",
        "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#282525\",\"color\":\"rgba(238,223,223,0.87)\",\"padding\":\"8px\",\"settings\":{\"btnbgcolor\":\"#e6049f\",\"btntxtcolor\":\"#ffffff\",\"attributeName\":\"stationInfo\",\"enableModule\":false},\"title\":\"Simple Note with Archiver\",\"showTitleIcon\":false,\"iconColor\":\"rgba(0, 0, 0, 0.87)\",\"iconSize\":\"24px\",\"titleTooltip\":\"\",\"dropShadow\":true,\"enableFullscreen\":true,\"widgetStyle\":{},\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"showLegend\":false}"
      }
    },
    {
      "alias": "key_value_storage",
      "name": "HC Production Value Storage",
      "image": null,
      "description": null,
      "descriptor": {
        "type": "latest",
        "sizeX": 12,
        "sizeY": 8.5,
        "resources": [],
        "templateHtml": "<mat-progress-bar *ngIf=\"disableForm\"\n          class=\"example-margin\"\n          color=\"accent\"\n          mode=\"indeterminate\"\n          >\n      </mat-progress-bar>\n<div class=\"df-report-wrapper\" style=\"overflow: auto; height: 100%;\">\n    <div class=\"df-report-heading\">\n        <h4 class=\"df-report-title\" style=\"text-align: center;\">{{settings?.title}}</h4>\n    </div>\n<div style=\"width: 95%; margin: 0 auto;text-align: center;\">\n    <mat-form-field appearance=\"outline\">\n      <mat-label [style.color]=\"color\">Select day</mat-label>\n      <input matInput id=\"day\" [matDatepicker]=\"datePicker\" (dateChange)=\"selectDay($event, datePicker)\" [max]=\"today\" (click)=\"openDatePicker(datePicker)\"  required>\n      <mat-datepicker-toggle matSuffix [for]=\"datePicker\"></mat-datepicker-toggle>\n        <mat-datepicker #datePicker></mat-datepicker>\n    </mat-form-field>\n    <p style=\"font-size: 15px; text-align: center;\" class=\"ng-star-inserted\">{{startDate}} to {{endDate}}</p>\n    </div>\n<mat-card style=\"width: 95%; margin: 0 auto;\" [style.background-color]=\"bgColor\">\n    <mat-card-content class=\"satl-auth-permission-config\">\n        <mat-spinner *ngIf=\"!showForm\" style=\"position: relative; top: 0; left: 0; margin: 0 auto; text-align: center;\"></mat-spinner>\n            <table style=\"width: 60%;margin: 0 auto;border-collapse: collapse;\" class=\"root_table\" *ngIf=\"showForm\">\n                <tr *ngFor=\"let root of prodData\">\n                    <td class=\"root_td\" style=\"display: flex;justify-content: space-between;border: 0.5px solid lightgray;\">\n                        <div style=\"width: 25%; margin: auto\">\n                            <mat-chip-list>\n                              <mat-chip style=\"background-color: #004f9f;\" selected>{{root.group}}</mat-chip>\n                            </mat-chip-list>\n                        </div>\n                        \n                        <table *ngIf=\"root.child?.length\" style=\"border-collapse: collapse;width: 75%;\" class=\"child_table\">\n                            <tr *ngFor=\"let first of root.child\" id=\"data2\">\n                                <td style=\"display: flex; border: 0.5px solid lightgray;border-right: 0; border-top:0;\">\n                                    <div class=\"chip\" style=\"width: 33%;margin:auto;\">\n                                        <mat-chip-list>\n                                          <mat-chip style=\"background-color: #5a328a;\" selected>{{first.group}}</mat-chip>\n                                        </mat-chip-list>\n                                    </div>\n                                    <table *ngIf=\"first.child?.length\" style=\"border-collapse: collapse;width: 67%\" class=\"leap\">\n                                        <tr *ngFor=\"let last of first.child\" id=\"data2\" style=\"border: 0.5px solid lightgray;border-bottom: 0; border-right: 0;\">\n                                            <td style=\"width: 33%;\">\n                                                <div>\n                                                    <mat-chip-list>\n                                                      <mat-chip style=\"background-color: #e72582;\" selected>{{last.group_name}}</mat-chip>\n                                                    </mat-chip-list>\n                                                </div>\n                                            </td>\n                                            <td>\n                                                <mat-form-field appearance=\"outline\">\n                                                    <mat-label [style.color]=\"color\">Value</mat-label>\n                                                    <input matInput type=\"number\" value={{last.dbl_v}} [style.color]=\"color\" placeholder=\"Enter value\" (blur)=\"submitForm($event, last)\" (keyup.enter)=\"submitForm($event, last)\">\n                                                    <mat-error>Field is required</mat-error>\n                                                </mat-form-field>\n                                            </td>\n                                        </tr>\n                                    </table>\n                                </td>\n                            </tr>\n                        </table>\n                    </td>\n                </tr>\n            </table>\n    </mat-card-content>\n</mat-card>\n</div>",
        "templateCss": ".df-report-wrapper::-webkit-scrollbar {\n  width: 11px;\n}\n.df-report-wrapper {\n  scrollbar-width: thin;\n  scrollbar-color: #90A4AE #CFD8DC;\n}\n.df-report-wrapper::-webkit-scrollbar-track {\n  background: #CFD8DC;\n}\n.df-report-wrapper::-webkit-scrollbar-thumb {\n  background-color: #90A4AE ;\n  border-radius: 6px;\n  border: 3px solid #CFD8DC;\n}\n\n.mat-form-field-appearance-outline .mat-form-field-outline {\n    color: #ccc;\n    /* Override outline color. */\n}\nmat-datepicker-toggle button.mat-focus-indicator.mat-icon-button.mat-button-base {\n    color: rgb(108 108 108);\n}\n.mat-form-field-appearance-outline .mat-form-field-infix {\n  padding: .7em 0; /* Original top/bottom value was 1em. */\n}\n\n \n.mat-input-element {\n  position: relative;\n  top:  -0.2em; /* Adjust accordingly to keep placeholder/input text vertically centered. */\n}\n.mat-form-field-wrapper {\n    padding-bottom: 0px;\n}\n.mat-chip-list-wrapper{\n    display: block;\n    text-align: center;\n}\ntr td, tr th{\n    padding: 0;\n}\ntr th{\n    text-align: center;\n    padding: 10px;\n    \n}\n.leap tr:first-child{\n    border-top: 0!important;\n}",
        "controllerScript": "self.onInit = function() {\n    let $scope=self.ctx.$scope;\n    $scope.settings=self.ctx.settings;\n    $scope.color=self.ctx.widgetConfig.color;\n    $scope.bgColor=self.ctx.widgetConfig.backgroundColor;\n    $scope.today=new Date();\n    $scope.showForm=false;\n    $scope.disableForm=false;\n    let date=new Date();\n    $scope.date=new Date();\n    $scope.selectDay=function($event, datePicker){\n        $scope.showForm=false;\n        date=$event.target.value;\n        $scope.date=date;\n        startProcess(new Date(moment(date).format('YYYY-MM-DD ')+self.ctx.settings.start_at),new Date(moment(date).format('YYYY-MM-DD ')+self.ctx.settings.end_at));\n    }\n    startProcess(new Date(moment(date).format('YYYY-MM-DD ')+self.ctx.settings.start_at),new Date(moment(date).format('YYYY-MM-DD ')+self.ctx.settings.end_at));\n    function startProcess(start_ts, end_ts){\n        $scope.showForm=false;\n        if(start_ts.getTime()>=end_ts.getTime()){\n            end_ts.setDate(end_ts.getDate()+1);\n        }\n        $scope.startDate=moment(start_ts).format('DD MMM, yyyy hh:mm A');\n        $scope.endDate=moment(end_ts).format('DD MMM, yyyy hh:mm A');\n        \n        self.ctx.http.post($scope.settings.api_get_url, {\"start_ts\": start_ts.getTime(), \"end_ts\": end_ts.getTime()}, {headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"X-Authorization\": \"Bearer \" +\n                        localStorage.getItem(\n                            'jwt_token')\n            }}).subscribe(response=>{\n            response.sort(function(a, b) {\n                if(a.root_group_name.toUpperCase()>b.root_group_name.toUpperCase()){\n                    return 1;\n                }\n                if(a.root_group_name.toUpperCase()<b.root_group_name.toUpperCase()){\n                    return -1;\n                }\n                return 0;\n            });\n            firstUniqueGroup = [...new Map(response.map(item =>[item['root_group_name'], item])).values()];\n            data=[];\n            firstUniqueGroup.forEach(fug=>{\n                x={group: fug.root_group_name, child:[]};\n                rootLevel=response.filter(fd=>fd.root_group_name==fug.root_group_name);\n                secondUniqueGroup= [...new Map(rootLevel.map(item =>[item['first_group_name'], item])).values()];\n                secondUniqueGroup.forEach(sug=>{\n                    t={group: sug.first_group_name, child:[]};\n                    rootLevel2=rootLevel.filter(fd=>fd.first_group_name==sug.first_group_name);\n                    rootLevel2.forEach(rl=>{\n                        t.child.push({root_group_name: fug.root_group_name, first_group_name: sug.first_group_name, group_name: rl.group_name, dbl_v: rl.dbl_v==null?0:rl.dbl_v});\n                    })\n                    x.child.push(t);\n                })\n                data.push(x);\n            });\n            $scope.showForm=true;\n            $scope.prodData=data;\n            self.ctx.detectChanges();\n        }, error=>{\n            self.ctx.showToast('error', 'Something went wrong! Reload the page.', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n            self.ctx.detectChanges();\n        });\n    }\n    \n    $scope.submitForm=function($event, last){\n        last['sts']=moment(date).format(\"yyyy-MMM-DD\").toUpperCase();\n        \n        if(Number($event.target.value)!=last.dbl_v){\n            $scope.disableForm=true;\n            last['dbl_v']=Number($event.target.value)<0||$event.target.value==null?0:Number($event.target.value);\n            $event.target.value=last['ddbl_v'];\n            self.ctx.http.post(self.ctx.settings.api_post_url, last, {headers: {\n                    \"Content-Type\": \"application/json\",\n                    \"X-Authorization\": \"Bearer \" +\n                        localStorage.getItem(\n                            'jwt_token')\n            }}).subscribe(res=>{\n                $scope.disableForm=false;\n                self.ctx.showToast('success', 'Data is updated successfully.', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n                self.ctx.detectChanges();\n            }, error=>{\n                $scope.disableForm=false;\n                self.ctx.showToast('error', 'Something went wrong.', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n                self.ctx.detectChanges(); \n            });\n        }\n    }\n    $scope.openDatePicker=function(picker){\n        picker.open();\n    }\n    \n}",
        "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"required\": [\n            \"api_get_url\", \"api_post_url\"\n        ],\n        \"properties\": {\n            \"title\":{\n                \"title\": \"Production Input\",\n                \"type\": \"string\",\n                \"default\": \"Production input\"\n            },\n            \"api_get_url\":{\n                \"title\": \"API GET URL\",\n                \"type\": \"string\",\n                \"default\": \"http://apinr.batb.syncross.ai/nrdapi/get_production_data\"\n            },\n            \"api_post_url\":{\n                \"title\": \"API POST URL\",\n                \"type\": \"string\",\n                \"default\": \"http://apinr.batb.syncross.ai/nrdapi/update_production_data\"\n            },\n            \"start_at\":{\n                \"title\":\"Starting time\",\n                \"type\":\"string\",\n                \"default\": \"12:00:00 AM\"\n            },\n            \"end_at\":{\n                \"title\":\"Ending time\",\n                \"type\":\"string\",\n                \"default\": \"11:59:59 PM\"\n            }\n        }\n    },\n    \"form\": [\n        \"title\",\n        \"api_get_url\",\n        \"api_post_url\",\n        \"start_at\",\n        \"end_at\"\n        ]\n}",
        "dataKeySettingsSchema": "{}\n",
        "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"api_get_url\":\"http://apinr.batb.syncross.ai/nrdapi/get_production_data\",\"api_post_url\":\"http://apinr.batb.syncross.ai/nrdapi/update_production_data\",\"start_at\":\"12:00:00 AM\",\"end_at\":\"11:59:59 PM\",\"title\":\"Production input\"},\"title\":\"HC Production Value Storage\"}"
      }
    },
    {
      "alias": "daily_data_view_in_month_whd",
      "name": "Daily data view in last 30 days",
      "image": "data:image/png;base64,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",
      "description": "Displays changes to timeseries data over time. For example, daily water consumption for last month.",
      "descriptor": {
        "type": "timeseries",
        "sizeX": 12,
        "sizeY": 5,
        "resources": [],
        "templateHtml": "",
        "templateCss": ".legend {\n    font-size: 13px;\n    line-height: 10px;\n}\n\n.legend table { \n    border-spacing: 0px;\n    border-collapse: separate;\n}\n\n.mouse-events .flot-overlay {\n    cursor: crosshair; \n}\n\n",
        "controllerScript": "\r\nself.onInit = function() {\r\n    self.ctx.cv = {};\r\n    self.ctx.$scope.updateCounter = 0;\r\n    self.ctx.$scope.updateTW = function(){\r\n        // let singleDayMs = 86400000;\r\n        // let m = moment(moment().format('YYYY-MM-DD 00:00'));\r\n        // m.add(1, 'day');\r\n        // ct = m.unix()*1000;\r\n        // m.subtract(1, 'years');\r\n        // pt = m.unix()*1000;\r\n        // self.ctx.timewindowFunctions.onUpdateTimewindow(pt, ct, singleDayMs);\r\n    }\r\n    self.ctx.defaultSubscription.timeWindow.interval = 24*3600*1000;\r\n    self.ctx.defaultSubscription.subscriptionTimewindow.aggregation.interval=24*3600*1000;\r\n    self.ctx.defaultSubscription.timeWindowConfig.history.interval=24*3600*1000;\r\n    self.ctx.flot = new TbFlot(self.ctx, 'bar');\r\n    \r\n    // Code to stop selection query\r\n    self.ctx.flot.$element.removeClass('mouse-events');\r\n    self.ctx.flot.$element.unbind('plotselected', self.ctx.flot.flotSelectHandler);\r\n    self.ctx.flot.$element.unbind('dblclick', self.ctx.flot.dblclickHandler);\r\n    self.ctx.flot.$element.unbind('mousedown', self.ctx.flot.mousedownHandler);\r\n    self.ctx.flot.$element.unbind('mouseup', self.ctx.flot.mouseupHandler);\r\n    self.ctx.flot.$element.unbind('mouseleave', self.ctx.flot.mouseleaveHandler);\r\n    self.ctx.flot.$element.unbind('plotclick', self.ctx.flot.flotClickHandler);\r\n}\r\n\r\nself.onDataUpdated = function() {\r\n    \r\n    if(self.ctx.$scope.updateCounter++ == 2){ \r\n        //self.ctx.$scope.updateTW();\r\n    }\r\n    \r\n    if(self.ctx.data.length>0){\r\n    \r\n        start_ts=new Date();\r\n        start_ts.setMonth(start_ts.getMonth()-1);\r\n        self.ctx.cv.token = localStorage.getItem('jwt_token');\r\n        self.ctx.defaultSubscription.timeWindow.interval = 24*3600*1000;\r\n        self.ctx.defaultSubscription.timeWindow.interval = 24*3600*1000;\r\n        self.ctx.defaultSubscription.subscriptionTimewindow.aggregation.interval=24*3600*1000;\r\n        self.ctx.defaultSubscription.timeWindowConfig.history.interval=24*3600*1000;\r\n        self.ctx.defaultSubscription.subscriptionTimewindow.aggregation.fixedWindow={\r\n                    \"startTimeMs\": start_ts.getTime(),\r\n                    \"endTimeMs\": new Date().getTime()\r\n                }\r\n        self.ctx.defaultSubscription.timeWindow.maxTime=new Date().getTime();\r\n        self.ctx.defaultSubscription.timeWindow.minTime=start_ts.getTime();\r\n        self.ctx.cv.entityId=self.ctx.defaultSubscription.datasources[0].entityId;\r\n        //let entityId='037c3cf0-8977-11ec-b586-f5145429eb39';\r\n        url='/nrdapi/get_daily_kwh';\r\n        let postData = { \r\n                start_ts: start_ts.getTime(),\r\n                end_ts: new Date().getTime(),\r\n                entity_id: self.ctx.cv.entityId\r\n            }\r\n            \r\n        let formatDate = function(d) {\r\n            let t = new Date(d);\r\n            let YYYY = t.toLocaleDateString(\"en-US\", { year: 'numeric' });\r\n            let MM = t.toLocaleDateString(\"en-US\", { month: '2-digit' });\r\n            let DD = t.toLocaleDateString(\"en-US\", { day: '2-digit' });\r\n            return `${YYYY}-${MM}-${DD}`;\r\n        }\r\n        \r\n        let totalDays = Math.ceil((postData.end_ts - postData.start_ts) / 86400000);\r\n        \r\n        let dds = [];\r\n        for (let i=0; i <= totalDays; i++) {\r\n            let d = postData.start_ts + (86400000 * i);\r\n             dds.push({\r\n                 net_kwh: 0,\r\n                 day: formatDate(d)\r\n             });\r\n        }\r\n            \r\n        let dataList=[];\r\n        self.ctx.http.post(url, postData, {headers:{\"Content-Type\":\"application/json\",\"X-Authorization\":\"Bearer \"+self.ctx.cv.token}})\r\n        \r\n        .subscribe(res=>{\r\n            \r\n            let ods = [];\r\n            dds.forEach(function(so){\r\n                let m = res.filter((r)=>{\r\n                    return r.day==so.day;\r\n                });\r\n                ods.push(m[0] || so);\r\n            });\r\n            \r\n            \r\n            ods.forEach(item=>{\r\n\r\n                let x=[];\r\n                x.push(new Date(item.day).getTime());\r\n                x.push(item.net_kwh);\r\n                dataList.push(x);\r\n            })\r\n            \r\n            self.ctx.defaultSubscription.data[0].data = dataList;\r\n            self.ctx.flot.update();\r\n        })\r\n        //self.ctx.flot.update();\r\n    }\r\n}\r\n\r\nself.onResize = function() {\r\n    self.ctx.flot.resize();\r\n}\r\n\r\nself.onEditModeChanged = function() {\r\n    self.ctx.flot.checkMouseEvents();\r\n}\r\n\r\nself.getSettingsSchema = function() {\r\n    return TbFlot.settingsSchema('bar');\r\n}\r\n\r\nself.getDataKeySettingsSchema = function() {\r\n    return TbFlot.datakeySettingsSchema(false, 'bar');\r\n}\r\n\r\nself.typeParameters = function() {\r\n    return {\r\n        maxDatasources: 1,\r\n        maxDataKeys: 1,\r\n        singleEntity: true\r\n    };\r\n};\r\n\r\nself.onDestroy = function() {\r\n    self.ctx.flot.destroy();\r\n}\r\n",
        "settingsSchema": "{}",
        "dataKeySettingsSchema": "{}",
        "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"entityAliasId\":null,\"filterId\":null,\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"First\",\"color\":\"#2196f3\",\"settings\":{\"showLines\":false,\"fillLines\":false,\"showPoints\":false},\"_hash\":0.8587686344902596,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < 0) {\\n\\tvalue = 0;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"hideInterval\":false,\"hideAggregation\":false,\"hideAggInterval\":false,\"hideTimezone\":false,\"selectedTab\":1,\"history\":{\"historyType\":1,\"fixedTimewindow\":{\"startTimeMs\":1622224800000,\"endTimeMs\":1624816800000},\"interval\":86400000},\"aggregation\":{\"type\":\"SUM\",\"limit\":200}},\"showTitle\":true,\"backgroundColor\":\"#111111\",\"color\":\"#ffffff\",\"padding\":\"8px\",\"settings\":{\"shadowSize\":4,\"fontColor\":\"#545454\",\"fontSize\":10,\"xaxis\":{\"showLabels\":true,\"color\":\"#b2b2b2\",\"title\":\"Months\"},\"yaxis\":{\"showLabels\":true,\"color\":\"#aeaeae\",\"title\":\"Energy (kWh)\"},\"grid\":{\"color\":\"#545454\",\"tickColor\":\"#DDDDDD\",\"verticalLines\":true,\"horizontalLines\":true,\"outlineWidth\":1},\"stack\":false,\"tooltipIndividual\":true,\"defaultBarWidth\":600,\"barAlignment\":\"right\",\"timeForComparison\":\"previousInterval\",\"xaxisSecond\":{\"axisPosition\":\"top\",\"showLabels\":true},\"showTooltip\":true},\"title\":\"Daily data view in last 30 days\",\"dropShadow\":true,\"enableFullscreen\":true,\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"mobileHeight\":null,\"widgetStyle\":{},\"useDashboardTimewindow\":false,\"showLegend\":false,\"actions\":{},\"displayTimewindow\":false,\"showTitleIcon\":false,\"iconColor\":\"rgba(0, 0, 0, 0.87)\",\"iconSize\":\"24px\",\"titleTooltip\":\"\",\"units\":\"kWh\",\"decimals\":0}"
      }
    },
    {
      "alias": "energy_report_hierarchical",
      "name": "Energy Report-Hierarchical",
      "image": null,
      "description": null,
      "descriptor": {
        "type": "latest",
        "sizeX": 7.5,
        "sizeY": 3,
        "resources": [],
        "templateHtml": "<div class=\"df-report-wrapper\" style=\"overflow: auto;height: 100%;width:100%\">\n    <div class=\"df-report-heading\">\n        <h4 style=\"text-align: center;\" class=\"df-report-title\">{{settings?.title}}</h4>\n    </div>\n    <div class=\"df-report-body\">\n        <div class=\"df-report-filter\">\n            <form method=\"POST\" *ngIf=\"filterForm\" [formGroup]=\"filterForm\">\n                <div class=\"row\">\n                    <div class=\"col-md-3 col-6\" style=\"text-align: center;\">\n                        <mat-form-field appearance=\"outline\">\n                          <mat-label [style.color]=\"color\">Report type</mat-label>\n                          <mat-select formControlName=\"reportType\" (selectionChange)=\"changeReportType($event)\">\n                            <mat-option *ngFor=\"let filter of filters\" [value]=\"filter\">{{filter}}</mat-option>\n                          </mat-select>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"col-md-3 col-6\" *ngIf=\"filterForm.value.reportType=='Daily'\" style=\"text-align: center;\">\n                        <mat-form-field appearance=\"outline\">\n                          <mat-label [style.color]=\"color\">Select day</mat-label>\n                          <input matInput id=\"day\" [matDatepicker]=\"datePicker\" (dateChange)=\"selectDay($event, datePicker)\" [max]=\"today\" (click)=\"openDatePicker(datePicker)\" required>\n                          <mat-datepicker-toggle matSuffix [for]=\"datePicker\"></mat-datepicker-toggle>\n                            <mat-datepicker #datePicker></mat-datepicker>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"col-md-3 col-6\" *ngIf=\"filterForm.value.reportType=='Weekly'\" style=\"text-align: center;\">\n                        <mat-form-field appearance=\"outline\">\n                          <mat-label [style.color]=\"color\">Enter a date range</mat-label>\n                          <mat-date-range-input [rangePicker]=\"picker\">\n                            <input matStartDate placeholder=\"Start date\" required (dateChange)=\"selectRangeStart($event, picker)\" (click)=\"openDatePicker(picker)\">\n                            <input matEndDate placeholder=\"End date\" required (dateChange)=\"selectRangeEnd($event, picker)\" (click)=\"openDatePicker(picker)\">\n                          </mat-date-range-input>\n                          <mat-datepicker-toggle matSuffix [for]=\"picker\"></mat-datepicker-toggle>\n                          <mat-date-range-picker #picker></mat-date-range-picker>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"col-md-3 col-6\" *ngIf=\"filterForm.value.reportType=='Monthly'\" style=\"text-align: center;\">\n                        <mat-form-field appearance=\"outline\">\n                          <mat-label [style.color]=\"color\">Select month</mat-label>\n                          <input matInput id=\"monthly\" [matDatepicker]=\"monthPicker\" required [max]=\"today\" (click)=\"openDatePicker(monthPicker)\">\n                          <mat-datepicker-toggle matSuffix [for]=\"monthPicker\"></mat-datepicker-toggle>\n                            <mat-datepicker #monthPicker startView=\"year\" (monthSelected)=\"selectMonth($event, monthPicker)\"></mat-datepicker>\n                        </mat-form-field>\n                    </div>\n                </div>\n            </form>\n            <p style=\"font-size: 15px; text-align:center;\" *ngIf=\"filterForm\">{{filterForm.value.start|date:'dd MMM, yyyy hh:mm a'}} to {{filterForm.value.end|date:'dd MMM, yyyy hh:mm a'}}</p>\n        </div>\n        <div class=\"df-report-content\">\n            <div *ngIf=\"!energyData\">\n                <mat-spinner\n                color=\"warn\" style=\"position: relative; top: 0; left: 0; margin: 0 auto; text-align: center;\">\n            </mat-spinner>\n            </div>\n            \n            <div class=\"mainctn\" *ngIf=\"energyData\" style=\"width: 100%;margin: 0 auto;\">\n                \n                <ng-template #recAccordion let-list=\"list\">  \n                    <mat-expansion-panel *ngFor=\"let item of list\" [hideToggle]=\"item.child.length==0\" [disabled]=\"item.child.length==0\" style=\"box-shadow: none; border-top: 1px solid #00000033; border-radius: 0;\" [style.background-color]=\"firstBgColor(item)\">\n                        <mat-expansion-panel-header [style.background-color]=\"firstBgColor(item)\">\n                          <mat-panel-title style=\"color: white!important;font-size:22px;margin-left:30px;\">\n                            {{item.group}}\n                          </mat-panel-title>\n                          <mat-panel-description style=\"color: white!important;font-size:22px;position:absolute; right:0;\">\n                              <div style=\"display:flex; justify-content:space-between; width: 800px;\">\n                                  <span>{{item.production}} million</span><span>{{item.energy_kwh}} kWh</span><span> {{numberWithCommas(item)}}</span>\n                              </div>\n                            \n                          </mat-panel-description>\n                        </mat-expansion-panel-header>\n                        <mat-accordion *ngIf=\"item.child.length>0\" class=\"child-of-{{item.group.replace(' ', '').toLowerCase()}}\">\n                            <ng-container *ngTemplateOutlet=\"recAccordion; context:{ list: item.child }\"></ng-container>\n                       </mat-accordion>\n                    </mat-expansion-panel>\n                </ng-template> \n                <div>\n                    <div style=\"padding: 10px 24px; display: flex;font-size:18px;background-color: #0e2b63; color: white;\">\n                        <div style=\"display: flex; flex-grow: 1;font-weight:bold;\">Name</div>\n                        <div style=\"right:0;\">\n                            <div style=\"display: flex; justify-content: space-between; width: 800px;\">\n                                <div style=\"font-weight:bold;\">Production</div>\n                            <div style=\"font-weight:bold;\">Electricity</div>\n                            <div style=\"font-weight:bold;\">ELectricity Index</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                \n                <mat-accordion>\n                    <ng-container  \n                   *ngTemplateOutlet=\"recAccordion; context:{ list: energyData }\"></ng-container>\n                </mat-accordion>\n            </div>\n        </div>\n    </div>\n</div>\n",
        "templateCss": "\ndiv.row{\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: center;\n}\ndiv.row div.col-md-3{\n    min-width: 250px;\n    margin: 10px;\n}\nmat-card-content{\n    display:flex;\n    justify-content: space-between;\n}\n.col-md-4.df-report-cal {\n    margin: 5px;\n    display: flex;\n    \n}\n\nh4.unit {\n    padding-left: 30px;\n}\n.df-report-wrapper::-webkit-scrollbar {\n  width: 11px;\n}\n.df-report-wrapper {\n  scrollbar-width: thin;\n  scrollbar-color: #90A4AE #CFD8DC;\n}\n.df-report-wrapper::-webkit-scrollbar-track {\n  background: #CFD8DC;\n}\n.df-report-wrapper::-webkit-scrollbar-thumb {\n  background-color: #90A4AE ;\n  border-radius: 6px;\n  border: 3px solid #CFD8DC;\n}\nmat-form-field{\n    width: 100%;\n}\n/* Angular Material Overrides */\n.mat-form-field-appearance-outline .mat-form-field-outline {\n  color: #ccc; /* Override outline color. */\n}\nmat-datepicker-toggle button.mat-focus-indicator.mat-icon-button.mat-button-base {\n    color: rgb(108 108 108);\n}\ndiv.mat-select-value,\ndiv.mat-select-arrow{\n    color: inherit!important;\n}\n.mat-progress-spinner circle{\n    fill:#00000015!important;\n}\n.col-md-4.df-report-cal .mat-card,\n.col-md-3.df-report-content-single .mat-card {\n    width: 100%;\n}\n.col-md-3.df-report-content-single .mat-card,\n.col-md-4.df-report-cal .mat-card{\n    border: 1px solid #ffbb00;\n    border-left: 10px solid #ffbb00;\n    box-shadow: 3px 3px 5px #ffbb00!important;\n}\n.col-md-4.df-report-cal .mat-card{\n    background-color: #fcfcfc!important;\n}\n.mat-card-title {\n    display: block;\n    margin-bottom: 8px;\n    color: #e72582;\n    font-size: 34px;\n    border-bottom: 1px solid;\n    padding-bottom: 15px;\n}\n\n\n@media screen and (min-width: 320px) {\n      .col-md-4.df-report-cal,.col-md-3.df-report-content-single{\n        width: 95%!important;\n    }\n}\n@media screen and (min-width: 768px) {\n      .col-md-4.df-report-cal{\n          width: 48%!important;\n      }\n      .col-md-4.df-report-cal:first-child{\n          width: 100%!important;\n      }\n      .col-md-3.df-report-content-single{\n        width: 45%!important;\n    }\n    .col-md-3.df-report-content-single h1{\n        font-size: 25px!important;\n    }\n    \n}\n@media screen and (min-width: 1200px) {\n      .col-md-4.df-report-cal{\n        width: 32%!important;\n    }\n    .col-md-4.df-report-cal:first-child{\n          width: 32%!important;\n      }\n    .col-md-3.df-report-content-single{\n        width: 47%!important;\n    }\n    .col-md-3.df-report-content-single h1{\n        font-size: 40px!important;\n    }\n}\n@media screen and (min-width: 1920px) {\n    .col-md-4.df-report-cal{\n        width: 32%!important;\n    }\n    .col-md-3.df-report-content-single{\n        width: 32%!important;\n    }\n}\n.col-md-3.df-report-content-single mat-card-content h1{\n    margin: auto;\n    margin-left: 0;\n}\n.mat-expansion-panel-body {\n    padding: 0 0 16px 24px!important;\n}\nspan.mat-content {\n    overflow: hidden;\n}\n.mat-expansion-panel-body {\n    padding: 0 0 0 24px!important;\n    border-bottom: 16px solid white!important;\n}\n\nspan.mat-expansion-indicator {\n    position: absolute;\n    left: 30px;\n    color: white!important;\n}\n.mat-expansion-indicator:after, .tb-default .mat-expansion-panel-header-description {\n    color: white;\n}",
        "controllerScript": "self.onInit = function() {\n    let http = {\n        method: self.ctx.http,\n        baseUrl: \"/nrdapi/\",\n        config: {\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"X-Authorization\": \"Bearer \" +\n                    localStorage.getItem(\n                        'jwt_token')\n            }\n        }\n    };\n    let $scope=self.ctx.$scope;\n    $scope.settings=self.ctx.settings;\n    $scope.bg=self.ctx.widgetConfig.backgroundColor;\n    $scope.color=self.ctx.widgetConfig.color;\n    $scope.filters=['Today','Daily', 'Weekly', 'Monthly'];\n    today=new Date();\n    $scope.today=today;\n    initForm();\n    function initForm(){\n        $scope.filterForm=$scope.fb.group({\n            reportType: ['Today'],\n            start: [moment(new Date()).format('YYYY-MM-DD ')+$scope.settings.start_at],\n            end:[new Date().getTime()]\n        });\n        \n        performAPIRequest($scope.filterForm.value);\n    }\n    $scope.selectMonth=function(eventData, dp) {\n        date_obj=new Date(eventData);\n        last_day=new Date(date_obj.getFullYear(), date_obj.getMonth()+1, 0);\n        lastDayDate=new Date(moment(eventData).format('YYYY-MM-')+last_day.getDate());\n        stts=new Date(moment(new Date()).format('YYYY-MM-DD ')+$scope.settings.start_at).getTime();\n        endts=new Date(moment(new Date()).format('YYYY-MM-DD ')+$scope.settings.end_at).getTime()+1000;\n        if(stts>=endts){\n            lastDayDate.setDate(lastDayDate.getDate()+1);\n        }\n        \n        \n        $(\"#monthly\").val(moment(eventData).format('YYYY-MM'));\n        $scope.filterForm.value.start=moment(eventData).format('YYYY-MM-')+'01 '+$scope.settings.start_at;\n        $scope.filterForm.value.end=moment(lastDayDate).format('YYYY-MM-DD')+' '+$scope.settings.end_at;\n        performAPIRequest($scope.filterForm.value);\n        dp.close();    \n    }\n    $scope.selectDay=function(eventData, dp){\n        date_obj=eventData.value;\n        stt=moment(date_obj).format('YYYY-MM-DD ')+$scope.settings.start_at\n        $scope.filterForm.value.start=stt;\n        nextDay=new Date(stt).getTime()+(24*60*59*1000);\n        $scope.filterForm.value.end=moment(nextDay).format('YYYY-MM-DD ')+$scope.settings.end_at;\n        performAPIRequest($scope.filterForm.value);\n    }\n    \n    $scope.selectRangeStart=function(eventData, dp){\n        $scope.filterForm.value.start=moment(eventData.value).format('YYYY-MM-DD ')+$scope.settings.start_at;\n    }\n    $scope.selectRangeEnd=function(eventData, dp){\n        const week=7*24*60*60*1000;\n        \n        stts=new Date(moment($scope.filterForm.value.start).format('YYYY-MM-DD ')+'00:00:00').getTime();\n        endts=new Date(moment(eventData.value).format('YYYY-MM-DD ')+'23:59:59').getTime()+1000;\n        if(week==(endts-stts)){\n            dto=new Date(eventData.value)\n            s=new Date(moment(new Date()).format('YYYY-MM-DD ')+$scope.settings.start_at).getTime();\n            e=new Date(moment(new Date()).format('YYYY-MM-DD ')+$scope.settings.end_at).getTime();\n            if(s>=e){\n                dto.setDate(dto.getDate()+1);\n            }\n            $scope.filterForm.value.end=moment(dto).format('YYYY-MM-DD ')+$scope.settings.end_at;\n            performAPIRequest($scope.filterForm.value)\n        }else{\n            self.ctx.showToast('error', 'Please exacly 7 days range', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n        }\n    }\n    $scope.changeReportType=function(event){\n        if(event.value=='Today'){\n            initForm();\n        }\n    }\n    function performAPIRequest(value){\n        $scope.energyData=null;\n        let st_ts=new Date(value.start)\n        let ed_ts=new Date(value.end)\n        if($scope.filterForm.value.reportType=='Today'){\n            const currentTs=new Date().getTime();\n            if(currentTs<=st_ts.getTime()){\n                st_ts.setDate(st_ts.getDate()-1);\n                ed_ts.setDate(ed_ts.getDate()-1);\n            }\n        }\n        http.method.post($scope.settings.api_url, {start_ts: st_ts.getTime(), end_ts: ed_ts.getTime()}, http.config).subscribe(response=>{\n            http.method.post($scope.settings.api_production_url, {start_ts: st_ts.getTime(), end_ts: ed_ts.getTime()}, http.config).subscribe(production=>{\n                edt=response;\n                edt.sort(function(a, b) {\n                    if(a.root_group_name.toUpperCase()>b.root_group_name.toUpperCase()){\n                        return 1;\n                    }\n                    if(a.root_group_name.toUpperCase()<b.root_group_name.toUpperCase()){\n                        return -1;\n                    }\n                    return 0;\n                });\n                firstUniqueGroup = [...new Map(edt.map(item =>[item['root_group_name'], item])).values()];\n                data=[];\n                firstUniqueGroup.forEach(fug=>{\n                    x={device_id: fug.device_id, group: fug.root_group_name, child:[]};\n                    rootLevel=edt.filter(fd=>fd.root_group_name==fug.root_group_name);\n                    x['energy_kwh']=Number(rootLevel.reduce(function(prev, cur) {\n                      return prev + Number(cur.energy_kwh);\n                    }, 0).toFixed(2));\n                    \n                    prdtRootLevel=production.filter(prdt=>prdt.root_group_name==fug.root_group_name);\n                    x['production']=Number(prdtRootLevel.reduce(function(prev, cur) {\n                      return prev + Number(cur.dbl_v);\n                    }, 0).toFixed(2));\n                    secondUniqueGroup= [...new Map(rootLevel.map(item =>[item['first_group_name'], item])).values()];\n                    secondUniqueGroup.forEach(sug=>{\n                        t={device_id: sug.device_id, group: sug.first_group_name, child:[]};\n                        rootLevel2=rootLevel.filter(fd=>fd.first_group_name==sug.first_group_name);\n                        t['energy_kwh']=rootLevel2.reduce(function(prev, cur) {\n                          return prev + Number(cur.energy_kwh);\n                        }, 0).toFixed(2);\n                        \n                        prdtRootLevel2=prdtRootLevel.filter(fd=>fd.first_group_name==sug.first_group_name);\n                        t['production']=prdtRootLevel2.reduce(function(prev, cur) {\n                          return prev + Number(cur.dbl_v);\n                        }, 0).toFixed(2);\n                        rootLevel2.forEach(rl=>{\n                            thas=t.child.filter(tt=>tt.group==rl.group_name);\n                            p=prdtRootLevel2.filter(pr=>pr.group_name==rl.group_name)[0];\n                            if(thas.length){\n                                indx=t.child.indexOf(thas[0]);\n                                t.child[indx].energy_kwh+=Number(Number(rl.energy_kwh).toFixed(2));\n                            }else{\n                                t.child.push({device_id: rl.device_id, group: rl.group_name, energy_kwh: Number(Number(rl.energy_kwh).toFixed(2)), production: Number(Number(p.dbl_v).toFixed(2)), child: []});\n                            }\n                        })\n                        x.child.push(t);\n                    })\n                    data.push(x);\n                });\n                $scope.energyData=data;\n                self.ctx.detectChanges();\n            });\n        }, error=>{\n            self.ctx.showToast('error', 'Something went wrong!', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n        });\n    }\n    $scope.numberWithCommas=function(x) {\n        if(x.production == 0 || x.energy_kwh==0){\n            return \"Not available\";\n        }\n        \n        let parts = (x.energy_kwh/x.production).toFixed(2).toString().split(\".\");\n        parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n        return parts.join(\".\")+\" kWh/mln\";\n    }\n    $scope.firstBgColor=function(item){\n        if($scope.energyData.indexOf(item)!=-1){\n            return '#004f9f';\n        }\n        if(item.child.length==0){\n            return '#e72582';\n        }\n        if($scope.energyData.indexOf(item)==-1&&item.child.length){\n            return '#5a328a';\n        }\n    }\n    $scope.openDatePicker=function(picker){\n        picker.open();\n    }\n}\n ",
        "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"required\": [\n        ],\n        \"properties\": {\n            \"title\":{\n                \"title\":\"Title\",\n                \"type\":\"string\"\n            },\n            \"start_at\":{\n                \"title\":\"Starting time\",\n                \"type\":\"string\",\n                \"default\": \"06:00:00 AM\"\n            },\n            \"end_at\":{\n                \"title\":\"Ending time\",\n                \"type\":\"string\",\n                \"default\": \"05:59:00 AM\"\n            },\n            \n            \"api_url\":{\n                \"title\": \"API URL\",\n                \"type\": \"string\",\n                \"default\": \"http://apinr.batb.syncross.ai/nrdapi/energy_report_hierarchy\"\n            },\n            \"api_production_url\":{\n                \"title\": \"API Production URL\",\n                \"type\": \"string\",\n                \"default\": \"http://apinr.batb.syncross.ai/nrdapi/get_production_data\"\n            }\n        }\n    },\n    \"form\": [\n        \"title\",\n        \"start_at\",\n        \"end_at\",\n        \"api_url\",\n        \"api_production_url\"\n        ]\n}",
        "dataKeySettingsSchema": "{}\n",
        "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"start_at\":\"06:00:00 AM\",\"end_at\":\"05:59:00 AM\",\"api_url\":\"http://apinr.batb.syncross.ai/nrdapi/energy_report_hierarchy\",\"api_production_url\":\"http://apinr.batb.syncross.ai/nrdapi/get_production_data\"},\"title\":\"Energy Report-Hierarchical\"}"
      }
    },
    {
      "alias": "energy_report_df",
      "name": "Energy Report-DF",
      "image": null,
      "description": null,
      "descriptor": {
        "type": "latest",
        "sizeX": 12,
        "sizeY": 6,
        "resources": [],
        "templateHtml": "<div class=\"df-report-wrapper\" style=\"overflow: auto;height: 100%;width:100%\">\n    <div class=\"df-report-heading\">\n        <h4 style=\"text-align: center;\" class=\"df-report-title\">{{settings?.title}}</h4>\n    </div>\n    <div class=\"df-report-body\">\n        <div class=\"df-report-filter\">\n            <form method=\"POST\" *ngIf=\"filterForm\" [formGroup]=\"filterForm\">\n                <div class=\"row\">\n                    <div class=\"col-md-3 col-6\" style=\"text-align: center;\">\n                        <mat-form-field appearance=\"outline\">\n                          <mat-label [style.color]=\"color\">Report type</mat-label>\n                          <mat-select formControlName=\"reportType\" (selectionChange)=\"changeReportType($event)\">\n                            <mat-option *ngFor=\"let filter of filters\" [value]=\"filter\">{{filter}}</mat-option>\n                          </mat-select>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"col-md-3 col-6\" *ngIf=\"filterForm.value.reportType=='Daily'\" style=\"text-align: center;\">\n                        <mat-form-field appearance=\"outline\">\n                          <mat-label [style.color]=\"color\">Select day</mat-label>\n                          <input matInput id=\"day\" [matDatepicker]=\"datePicker\" (dateChange)=\"selectDay($event, datePicker)\" [max]=\"today\" required>\n                          <mat-datepicker-toggle matSuffix [for]=\"datePicker\"></mat-datepicker-toggle>\n                            <mat-datepicker #datePicker></mat-datepicker>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"col-md-3 col-6\" *ngIf=\"filterForm.value.reportType=='Weekly'\" style=\"text-align: center;\">\n                        <mat-form-field appearance=\"outline\">\n                          <mat-label [style.color]=\"color\">Enter a date range</mat-label>\n                          <mat-date-range-input [rangePicker]=\"picker\">\n                            <input matStartDate placeholder=\"Start date\" required (dateChange)=\"selectRangeStart($event, picker)\">\n                            <input matEndDate placeholder=\"End date\" required (dateChange)=\"selectRangeEnd($event, picker)\">\n                          </mat-date-range-input>\n                          <mat-datepicker-toggle matSuffix [for]=\"picker\"></mat-datepicker-toggle>\n                          <mat-date-range-picker #picker></mat-date-range-picker>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"col-md-3 col-6\" *ngIf=\"filterForm.value.reportType=='Monthly'\" style=\"text-align: center;\">\n                        <mat-form-field appearance=\"outline\">\n                          <mat-label [style.color]=\"color\">Select month</mat-label>\n                          <input matInput id=\"monthly\" [matDatepicker]=\"monthPicker\" required [max]=\"today\">\n                          <mat-datepicker-toggle matSuffix [for]=\"monthPicker\"></mat-datepicker-toggle>\n                            <mat-datepicker #monthPicker startView=\"year\" (monthSelected)=\"selectMonth($event, monthPicker)\"></mat-datepicker>\n                        </mat-form-field>\n                    </div>\n                </div>\n            </form>\n            <p style=\"font-size: 15px; text-align:center;\" *ngIf=\"filterForm\">{{filterForm.value.start|date:'dd MMM, yyyy hh:mm a'}} to {{filterForm.value.end|date:'dd MMM, yyyy hh:mm a'}}</p>\n        </div>\n        <div class=\"df-report-content\">\n            <div *ngIf=\"!energyData\">\n                <div *ngIf=\"request_type=='MULTI'\">\n                    <mat-progress-spinner\n                class=\"example-margin\"\n                color=\"warn\"\n                mode=\"determinate\"\n                [value]=\"parcentage\" style=\"position: relative; top: 0; left: 0; margin: 0 auto; text-align: center;\">\n            </mat-progress-spinner>\n            <div style=\"position:relative; top: -60px; left: 0; margin:0 auto;text-align:center;\">{{parcentage}}%</div>\n                </div>\n                <div *ngIf=\"request_type=='SINGLE'\">\n                    <mat-spinner\n                        color=\"warn\"\n                        mode=\"indeterminate\"\n                        style=\"position: relative; top: 0; left: 0; margin: 0 auto; text-align: center;\">\n                    </mat-spinner>\n                </div>\n            </div>\n            \n            \n            \n            <div class=\"row\" *ngIf=\"energyData\">\n                <div class=\"col-md-4 df-report-cal\">\n                    <mat-card [style.background-color]=\"settings?.card_bg_color\" [style.color]=\"settings?.card_txt_color\">\n                        <mat-card-title style=\"text-align: center;\">\n                            Total consumption\n                        </mat-card-title>\n                        <mat-card-content>\n                            <h1>{{numberWithCommas(total.toFixed(2))}}</h1>\n                            <h4 class=\"unit\">{{settings?.unit}}</h4>\n                        </mat-card-content>\n                    </mat-card>\n                </div>\n                <div class=\"col-md-4 df-report-cal\">\n                    <mat-card [style.background-color]=\"settings?.card_bg_color\" [style.color]=\"settings?.card_txt_color\">\n                        <mat-card-title style=\"text-align: center;\">\n                            Total Gj\n                        </mat-card-title>\n                        <mat-card-content>\n                            <h1>{{numberWithCommas(gj.toFixed(2))}}</h1>\n                            <!--<h4 class=\"unit\">{{settings?.unit}}</h4>-->\n                        </mat-card-content>\n                    </mat-card>\n                </div>\n                \n                <div class=\"col-md-4 df-report-cal\">\n                    <mat-card [style.background-color]=\"settings?.card_bg_color\" [style.color]=\"settings?.card_txt_color\">\n                        <mat-card-title style=\"text-align: center;\">\n                            Total Co2\n                        </mat-card-title>\n                        <mat-card-content>\n                            <h1>{{numberWithCommas(tco.toFixed(2))}}</h1>\n                            <!--<h4 class=\"unit\">{{settings?.unit}}</h4>-->\n                        </mat-card-content>\n                    </mat-card>\n                </div>\n            </div>\n            <div class=\"space\" style=\"height:30px;\">\n                \n            </div>\n            <div class=\"row\" *ngIf=\"energyData\">\n                <div class=\"col-md-3 df-report-content-single\" *ngFor=\"let data of energyData\">\n                <mat-card [style.background-color]=\"settings?.card_bg_color\" [style.color]=\"settings?.card_txt_color\">\n                    <mat-card-title style=\"text-align: center;\">\n                        {{data.group_name}}\n                    </mat-card-title>\n                    <mat-card-content>\n                        <h1>{{numberWithCommas(data.net_kwh.toFixed(2))}}</h1>\n                        <h4 class=\"unit\">{{settings?.unit}}</h4>\n                    </mat-card-content>\n                </mat-card>\n            </div>\n            </div>\n        </div>\n    </div>\n</div>",
        "templateCss": "div.row{\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: center;\n}\ndiv.row div.col-md-3{\n    min-width: 250px;\n    margin: 5px;\n}\nmat-card-content{\n    display:flex;\n    justify-content: space-between;\n}\n.col-md-4.df-report-cal {\n    margin: 5px;\n    display: flex;\n    \n}\n\nh4.unit {\n    padding-left: 30px;\n}\n.df-report-wrapper::-webkit-scrollbar {\n  width: 11px;\n}\n.df-report-wrapper {\n  scrollbar-width: thin;\n  scrollbar-color: #90A4AE #CFD8DC;\n}\n.df-report-wrapper::-webkit-scrollbar-track {\n  background: #CFD8DC;\n}\n.df-report-wrapper::-webkit-scrollbar-thumb {\n  background-color: #90A4AE ;\n  border-radius: 6px;\n  border: 3px solid #CFD8DC;\n}\nmat-form-field{\n    width: 100%;\n}\n/* Angular Material Overrides */\n.mat-form-field-appearance-outline .mat-form-field-outline {\n  color: #ccc; /* Override outline color. */\n}\nmat-datepicker-toggle button.mat-focus-indicator.mat-icon-button.mat-button-base {\n    color: rgb(108 108 108);\n}\ndiv.mat-select-value,\ndiv.mat-select-arrow{\n    color: inherit!important;\n}\n.mat-progress-spinner circle{\n    fill:#00000015!important;\n}\n.col-md-4.df-report-cal .mat-card,\n.col-md-3.df-report-content-single .mat-card {\n    background: #fff;\n    width: 500px;\n    margin: 10px;\n    border: 1px solid #ffbb00;\n    border-left: 10px solid #ffbb00;\n    box-shadow: 3px 3px 5px #ffbb00!important;\n}\n.mat-card-title {\n    display: block;\n    margin-bottom: 8px;\n    color: #e72582;\n    font-size: 34px;\n    border-bottom: 1px solid;\n    padding-bottom: 15px;\n}",
        "controllerScript": "self.onInit = function() {\n    let http = {\n        method: self.ctx.http,\n        baseUrl: \"/nrdapi/\",\n        config: {\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"X-Authorization\": \"Bearer \" +\n                    localStorage.getItem(\n                        'jwt_token')\n            }\n        }\n    };\n    let $scope=self.ctx.$scope;\n    $scope.settings=self.ctx.settings;\n    $scope.bg=self.ctx.widgetConfig.backgroundColor;\n    $scope.color=self.ctx.widgetConfig.color;\n    $scope.filters=['Today','Daily', 'Weekly', 'Monthly'];\n    today=new Date();\n    $scope.today=today;\n    nxt=today.getTime()+(24*60*60*1000);\n    initForm();\n    function initForm(){\n        $scope.filterForm=$scope.fb.group({\n            reportType: ['Today'],\n            start: [moment(new Date()).format('YYYY-MM-DD ')+$scope.settings.start_at],\n            end:[moment(new Date(nxt)).format('YYYY-MM-DD ')+$scope.settings.end_at]\n        });\n        performAPIRequest($scope.filterForm.value);\n    }\n    $scope.selectMonth=function(eventData, dp) {\n        date_obj=new Date(eventData);\n        last_day=new Date(date_obj.getFullYear(), date_obj.getMonth()+1, 0);\n        lastDayDate=new Date(moment(eventData).format('YYYY-MM-')+last_day.getDate());\n        stts=new Date(moment(new Date()).format('YYYY-MM-DD ')+$scope.settings.start_at).getTime();\n        endts=new Date(moment(new Date()).format('YYYY-MM-DD ')+$scope.settings.end_at).getTime()+1000;\n        if(stts>=endts){\n            lastDayDate.setDate(lastDayDate.getDate()+1);\n        }\n        \n        \n        $(\"#monthly\").val(moment(eventData).format('YYYY-MM'));\n        $scope.filterForm.value.start=moment(eventData).format('YYYY-MM-')+'01 '+$scope.settings.start_at;\n        $scope.filterForm.value.end=moment(lastDayDate).format('YYYY-MM-DD')+' '+$scope.settings.end_at;\n        performAPIRequest($scope.filterForm.value);\n        dp.close();    \n    }\n    $scope.selectDay=function(eventData, dp){\n        date_obj=eventData.value;\n        $scope.filterForm.value.start=moment(date_obj).format('YYYY-MM-DD ')+$scope.settings.start_at;\n        nextDay=date_obj.getTime()+(24*60*60*1000);\n        $scope.filterForm.value.end=moment(nextDay).format('YYYY-MM-DD ')+$scope.settings.end_at;\n        performAPIRequest($scope.filterForm.value);\n    }\n    \n    $scope.selectRangeStart=function(eventData, dp){\n        $scope.filterForm.value.start=moment(eventData.value).format('YYYY-MM-DD ')+$scope.settings.start_at;\n    }\n    $scope.selectRangeEnd=function(eventData, dp){\n        const week=7*24*60*60*1000;\n        \n        stts=new Date(moment($scope.filterForm.value.start).format('YYYY-MM-DD ')+'00:00:00').getTime();\n        endts=new Date(moment(eventData.value).format('YYYY-MM-DD ')+'23:59:59').getTime()+1000;\n        if(week==(endts-stts)){\n            dto=new Date(eventData.value)\n            dto.setDate(dto.getDate()+1);\n            $scope.filterForm.value.end=moment(dto).format('YYYY-MM-DD ')+$scope.settings.end_at;\n            performAPIRequest($scope.filterForm.value)\n        }else{\n            self.ctx.showToast('error', 'Please exacly 7 days range', 2000, 'top', 'start',  self.ctx.$scope.toastTargetId);\n        }\n    }\n    $scope.changeReportType=function(event){\n        if(event.value=='Today'){\n            initForm();\n        }\n    }\n    function performAPIRequest(value){\n        $scope.request_type=self.ctx.settings.request_type?'SINGLE': 'MULTI';\n        $scope.energyData=null;\n        let st_ts=new Date(value.start)\n        let ed_ts=new Date(value.end)\n        if($scope.filterForm.value.reportType=='Today'){\n            const currentTs=new Date().getTime();\n            if(currentTs<=st_ts.getTime()){\n                st_ts.setDate(st_ts.getDate()-1);\n                ed_ts.setDate(ed_ts.getDate()-1);\n            }\n        }\n        dtList=[];\n        if(self.ctx.settings.request_type){\n            dtList.push({start_ts: st_ts.getTime(), end_ts: ed_ts.getTime()});\n        }else{\n            for(let s=st_ts.getTime(); s<=ed_ts.getTime();s+=(24*3600*1000)){\n                dtList.push({start_ts: s, end_ts: (s+24*3600*1000-1000)});\n            }\n        }\n        recursiveHttp(dtList, 0, dtList.length, {});\n    }\n    function recursiveHttp(data, current_index, length, resp){\n        $scope.parcentage=Number((current_index/length)*100).toFixed(2);\n        self.ctx.detectChanges();\n        if(current_index<length){\n            http.method.post($scope.settings.api_url, data[current_index], http.config).subscribe(response=>{\n                response.forEach(res=>{\n                    if(resp[res.group_name]==undefined){\n                        resp[res.group_name]=res.net_kwh;\n                    }else{\n                        resp[res.group_name]+=res.net_kwh;\n                    }\n                })\n                current_index+=1;\n                recursiveHttp(data, current_index, length, resp);\n            });\n        }else{\n            ds=[];\n            for (const [key, value] of Object.entries(resp)) {\n              ds.push({'group_name':key, 'net_kwh': value});\n            }\n            $scope.energyData=ds;\n            let total=0;\n            ds.forEach(res=>{\n                total+=res.net_kwh;\n            });\n            $scope.total=total;\n            let total_gj=total*0.0036;\n            $scope.gj=total_gj;\n            let total_tco2=total_gj*0.12942;\n            $scope.tco=total_tco2;\n            self.ctx.detectChanges();\n        }\n    }\n    $scope.numberWithCommas=function(x) {\n        let parts = x.toString().split(\".\");\n        parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n        return parts.join(\".\");\n    }\n}\n ",
        "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"required\": [\n        ],\n        \"properties\": {\n            \"title\":{\n                \"title\":\"Title\",\n                \"type\":\"string\"\n            },\n            \"request_type\":{\n                \"title\":\"Single HTTP request\",\n                \"type\":\"boolean\",\n                \"default\": \"false\"\n            },\n            \"start_at\":{\n                \"title\":\"Starting time\",\n                \"type\":\"string\",\n                \"default\": \"06:00:00 AM\"\n            },\n            \"end_at\":{\n                \"title\":\"Ending time\",\n                \"type\":\"string\",\n                \"default\": \"05:59:00 AM\"\n            },\n            \n            \"unit\":{\n                \"title\":\"Unit\",\n                \"type\":\"string\",\n                \"default\": \"kWh\"\n            },\n            \n            \"api_url\":{\n                \"title\": \"API URL\",\n                \"type\": \"string\",\n                \"default\": \"http://apinr.batb.syncross.ai/nrdapi/energy_report_df\"\n            },\n            \"card_bg_color\":{\n                \"title\": \"Card background color\",\n                \"type\": \"string\",\n                \"default\": \"#ffffff\"\n            },\n            \"card_txt_color\":{\n                \"title\": \"Card text color\",\n                \"type\": \"string\",\n                \"default\": \"#000000\"\n            }\n        }\n    },\n    \"form\": [\n        \"title\",\n        {\n            \"key\": \"request_type\",\n            \"type\": \"checkbox\"\n        },\n        \"start_at\",\n        \"end_at\",\n        \"unit\",\n        \"api_url\",\n        {\n            \"key\": \"card_bg_color\",\n            \"type\": \"color\"\n        },\n        {\n            \"key\": \"card_txt_color\",\n            \"type\": \"color\"\n        }\n        ]\n}",
        "dataKeySettingsSchema": "{}\n",
        "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":true,\"backgroundColor\":\"#fff\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"title\":\"Energy Report-DF\",\"start_at\":\"06:00:00 AM\",\"end_at\":\"05:59:00 AM\",\"unit\":\"kWh\",\"api_url\":\"http://apinr.batb.syncross.ai/nrdapi/energy_report_df\",\"card_bg_color\":\"#ffffff\",\"card_txt_color\":\"#000000\"},\"title\":\"Energy Report-DF\"}"
      }
    },
    {
      "alias": "last_12_months_view_whd",
      "name": "Last 12 months view",
      "image": "data:image/png;base64,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",
      "description": "Displays changes to timeseries data over time. For example, daily water consumption for last month.",
      "descriptor": {
        "type": "timeseries",
        "sizeX": 8,
        "sizeY": 5,
        "resources": [],
        "templateHtml": "",
        "templateCss": ".legend {\n    font-size: 13px;\n    line-height: 10px;\n}\n\n.legend table { \n    border-spacing: 0px;\n    border-collapse: separate;\n}\n\n.mouse-events .flot-overlay {\n    cursor: crosshair; \n}\n\n",
        "controllerScript": "\nself.onInit = function() {\n    \n    self.ctx.$scope.updateCounter = 0;\n    self.ctx.$scope.updateTW = function(){\n        // let singleDayMs = 86400000;\n        // let m = moment(moment().format('YYYY-MM-DD 00:00'));\n        // m.add(1, 'day');\n        // ct = m.unix()*1000;\n        // m.subtract(1, 'years');\n        // pt = m.unix()*1000;\n        // self.ctx.timewindowFunctions.onUpdateTimewindow(pt, ct, singleDayMs);\n    }\n    self.ctx.defaultSubscription.timeWindow.interval = 2628000000;\n    self.ctx.defaultSubscription.subscriptionTimewindow.aggregation.interval=2628000000;\n    self.ctx.defaultSubscription.timeWindowConfig.history.interval=2628000000;\n    self.ctx.flot = new TbFlot(self.ctx, 'bar');\n    \n    // Code to stop selection query\n    self.ctx.flot.$element.removeClass('mouse-events');\n    self.ctx.flot.$element.unbind('plotselected', self.ctx.flot.flotSelectHandler);\n    self.ctx.flot.$element.unbind('dblclick', self.ctx.flot.dblclickHandler);\n    self.ctx.flot.$element.unbind('mousedown', self.ctx.flot.mousedownHandler);\n    self.ctx.flot.$element.unbind('mouseup', self.ctx.flot.mouseupHandler);\n    self.ctx.flot.$element.unbind('mouseleave', self.ctx.flot.mouseleaveHandler);\n    self.ctx.flot.$element.unbind('plotclick', self.ctx.flot.flotClickHandler);\n}\n\nself.onDataUpdated = function() {\n    \n    if(self.ctx.$scope.updateCounter++ == 2){ \n        self.ctx.$scope.updateTW();\n    }\n    \n    if(self.ctx.data.length>0){\n        let url12m='/nrdapi/get_monthly_kwh';\n        let token12m = localStorage.getItem('jwt_token');\n        self.ctx.defaultSubscription.timeWindow.interval = 2628000000\n\n        let entityId12m=self.ctx.defaultSubscription.datasources[0].entityId;\n        // entityId='037c3cf0-8977-11ec-b586-f5145429eb39';\n        \n        let startDate12m=new Date(moment(new Date()).format('YYYY-MM-DD 23:59:59'));\n        startDate12m.setYear(startDate12m.getFullYear()-1);\n        let endDate12m=new Date(moment(new Date()).format('YYYY-MM-DD 23:59:59'));\n        let payload12m={ \n            'start_ts': startDate12m.getTime(), \n            'end_ts': endDate12m.getTime(), \n            'entity_id': entityId12m\n        }\n        let req12m=self.ctx.http.post(url12m, payload12m, {headers:{\"Content-Type\":\"application/json\",\"X-Authorization\":\"Bearer \"+token12m}});\n        \n        self.ctx.defaultSubscription.timeWindow.interval = 2628000000;\n        self.ctx.defaultSubscription.subscriptionTimewindow.aggregation.interval=2628000000;\n        \n        self.ctx.defaultSubscription.subscriptionTimewindow.aggregation.fixedWindow={\n                \"startTimeMs\": startDate12m.getTime(),\n                \"endTimeMs\": endDate12m.getTime()\n            }\n        self.ctx.defaultSubscription.timeWindow.maxTime=new Date().getTime();\n        self.ctx.defaultSubscription.timeWindow.minTime=startDate12m.getTime();\n        \n        self.ctx.defaultSubscription.timeWindowConfig.history.interval=2628000000;\n        preData12m=[];\n        for(;startDate12m<=endDate12m; startDate12m.setMonth(startDate12m.getMonth()+1)){\n            preData12m.push({\n                net_kwh: 0,\n                month: moment(startDate12m).format('YYYY-MM')\n            });\n        }\n        preData12m.shift();\n        let dataList12m=[];\n        req12m.subscribe(res=>{\n            f12m=[];\n            preData12m.forEach(item=>{\n                let ct12m=res.filter(resObj=>resObj.month==item.month);\n                if(ct12m.length){\n                    f12m.push({\n                        net_kwh: ct12m[0].net_kwh,\n                        month: item.month\n                    });\n                }else{\n                    f12m.push(item);\n                }\n            });\n            f12m.forEach(item=>{\n                let x=[];\n                x.push(new Date(item.month).getTime());\n                x.push(item.net_kwh);\n                dataList12m.push(x);\n            });\n            self.ctx.defaultSubscription.data[0].data = dataList12m;\n            self.ctx.flot.update();\n        });\n    }\n}\n\nself.onResize = function() {\n    self.ctx.flot.resize();\n}\n\nself.onEditModeChanged = function() {\n    self.ctx.flot.checkMouseEvents();\n}\n\nself.getSettingsSchema = function() {\n    return TbFlot.settingsSchema('bar');\n}\n\nself.getDataKeySettingsSchema = function() {\n    return TbFlot.datakeySettingsSchema(false, 'bar');\n}\n\nself.typeParameters = function() {\n    return {\n        maxDatasources: 1,\n        maxDataKeys: 1,\n        singleEntity: true\n    };\n};\n\nself.onDestroy = function() {\n    self.ctx.flot.destroy();\n}\n",
        "settingsSchema": "",
        "dataKeySettingsSchema": "{}",
        "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"entityAliasId\":null,\"filterId\":null,\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"First\",\"color\":\"#2196f3\",\"settings\":{\"showLines\":false,\"fillLines\":false,\"showPoints\":false},\"_hash\":0.8587686344902596,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < 0) {\\n\\tvalue = 0;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"hideInterval\":false,\"hideAggregation\":false,\"hideAggInterval\":false,\"hideTimezone\":false,\"selectedTab\":1,\"history\":{\"historyType\":0,\"timewindowMs\":60000,\"interval\":5000,\"fixedTimewindow\":{\"startTimeMs\":1593453600000,\"endTimeMs\":1625037333639},\"quickInterval\":\"CURRENT_DAY\"},\"aggregation\":{\"type\":\"SUM\",\"limit\":200}},\"showTitle\":true,\"backgroundColor\":\"#111111\",\"color\":\"#ffffff\",\"padding\":\"8px\",\"settings\":{\"shadowSize\":4,\"fontColor\":\"#545454\",\"fontSize\":10,\"xaxis\":{\"showLabels\":true,\"color\":\"#b2b2b2\",\"title\":\"Months\"},\"yaxis\":{\"showLabels\":true,\"color\":\"#aeaeae\",\"title\":\"Energy (kWh)\"},\"grid\":{\"color\":\"#545454\",\"tickColor\":\"#DDDDDD\",\"verticalLines\":true,\"horizontalLines\":true,\"outlineWidth\":1},\"stack\":false,\"tooltipIndividual\":true,\"defaultBarWidth\":600,\"barAlignment\":\"right\",\"timeForComparison\":\"previousInterval\",\"xaxisSecond\":{\"axisPosition\":\"top\",\"showLabels\":true},\"showTooltip\":true},\"title\":\"Last 12 months view\",\"dropShadow\":true,\"enableFullscreen\":true,\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"mobileHeight\":null,\"widgetStyle\":{},\"useDashboardTimewindow\":false,\"showLegend\":false,\"actions\":{},\"displayTimewindow\":false,\"showTitleIcon\":false,\"iconColor\":\"rgba(0, 0, 0, 0.87)\",\"iconSize\":\"24px\",\"titleTooltip\":\"\",\"units\":\"kWh\",\"decimals\":0}"
      }
    },
    {
      "alias": "consumed_whd",
      "name": "Consumed WHD",
      "image": null,
      "description": null,
      "descriptor": {
        "type": "latest",
        "sizeX": 10,
        "sizeY": 3,
        "resources": [],
        "templateHtml": "",
        "templateCss": "#container {\n    overflow: auto;\n}\n\n.tbDatasource-container {\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n}\n\n.tbDatasource-table {\n    width: 100%;\n    height: 100%;\n    border-collapse: collapse;\n    white-space: nowrap;\n    font-weight: 100;\n    text-align: right;\n}\n\n.tbDatasource-table td {\n    padding: 12px;\n    position: relative;\n    box-sizing: border-box;\n}\n\n.tbDatasource-data-key {\n    opacity: 0.7;\n    font-weight: 400;\n    font-size: 3.500rem;\n}\n\n.tbDatasource-value {\n    font-size: 5.000rem;\n}",
        "controllerScript": "self.onInit = function() {\r\n    self.ctx.labelPosition = self.ctx.settings.labelPosition || 'left';\r\n    \r\n    if (self.ctx.datasources.length > 0) {\r\n        var tbDatasource = self.ctx.datasources[0];\r\n        var datasourceId = 'tbDatasource' + 0;\r\n\r\n        self.ctx.$container.append(\r\n            \"<div id='\" + datasourceId +\r\n            \"' class='tbDatasource-container'></div>\"\r\n        );\r\n        \r\n        self.ctx.datasourceContainer = $('#' + datasourceId,\r\n            self.ctx.$container);\r\n        \r\n        var tableId = 'table' + 0;\r\n        self.ctx.datasourceContainer.append(\r\n            \"<table id='\" + tableId +\r\n            \"' class='tbDatasource-table'><col width='30%'><col width='70%'></table>\"\r\n        );\r\n        var table = $('#' + tableId, self.ctx.$container);\r\n        if (self.ctx.labelPosition === 'top') {\r\n            table.css('text-align', 'left');\r\n        }\r\n        \r\n        if (tbDatasource.dataKeys.length > 0) {\r\n            var dataKey = tbDatasource.dataKeys[0];\r\n            var labelCellId = 'labelCell' + 0;\r\n            var cellId = 'cell' + 0;\r\n            if (self.ctx.labelPosition === 'left') {\r\n                table.append(\r\n                    \"<tr><td class='tbDatasource-data-key' id='\" + labelCellId +\"'>\" +\r\n                    dataKey.label +\r\n                    \"</td><td class='tbDatasource-value' id='\" +\r\n                    cellId +\r\n                    \"'></td></tr>\");\r\n            } else {\r\n                table.append(\r\n                    \"<tr style='vertical-align: bottom;'><td class='tbDatasource-data-key' id='\" + labelCellId +\"'>\" +\r\n                    dataKey.label +\r\n                    \"</td></tr><tr><td class='tbDatasource-value' id='\" +\r\n                    cellId +\r\n                    \"'></td></tr>\");\r\n            }\r\n            self.ctx.labelCell = $('#' + labelCellId, table);\r\n            self.ctx.valueCell = $('#' + cellId, table);\r\n            self.ctx.valueCell.html(0 + ' ' + self.ctx.units);\r\n        }\r\n    }\r\n    \r\n    $.fn.textWidth = function(){\r\n        var html_org = $(this).html();\r\n        var html_calc = '<span>' + html_org + '</span>';\r\n        $(this).html(html_calc);\r\n        var width = $(this).find('span:first').width();\r\n        $(this).html(html_org);\r\n        return width;\r\n    };    \r\n    \r\n    self.onResize();\r\n};\r\n\r\nself.onDataUpdated = function() {\r\n    let url=self.ctx.settings.apiEndpoint;  //'/nrdapi/get_monthly_kwh';\r\n    \r\n    function isNumber(n) {\r\n        return !isNaN(parseFloat(n)) && isFinite(n);\r\n    }\r\n    \r\n    function numberWithCommas(x) {\r\n        //return x.toString().replace(/\\B(?<!\\.\\d*)(?=(\\d{3})+(?!\\d))/g, \",\"); // lookbehind problem at ios devices\r\n        var parts = x.toString().split(\".\");\r\n        parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\r\n        return parts.join(\".\");\r\n    }\r\n\r\n    if (self.ctx.valueCell && self.ctx.data.length > 0) {\r\n        var cellData = self.ctx.data[0];\r\n        if (cellData.data.length > 0) {\r\n            \r\n            let token = localStorage.getItem('jwt_token');\r\n            var value = 0;\r\n            let startTime=0; //self.ctx.settings.durationType=='Monthly'?moment(new Date()).format('YYYY-MM-01 00:00:00'):moment(new Date()).format('YYYY-01-01 00:00:00');\r\n            \r\n            if(self.ctx.settings.durationType == 'thisMonth') { \r\n                startTime = new Date(moment().format('YYYY-MM-01 '+self.ctx.settings.defaultStartTime));\r\n                if(startTime>=new Date()){\r\n                    startTime.setMonth(startTime.getMonth()-1);\r\n                }\r\n            }\r\n            else if(self.ctx.settings.durationType == 'thisYear') {  \r\n                startTime = new Date(moment().format('YYYY-01-01 '+self.ctx.settings.defaultStartTime));\r\n                if(startTime>=new Date()){\r\n                    startTime.setFullYear(startTime.getFullYear()-1);\r\n                }\r\n            }\r\n            else { \r\n                now=new Date();\r\n                startTime=new Date(moment().format('YYYY-MM-DD '+self.ctx.settings.defaultStartTime));\r\n                if(now<=startTime){\r\n                    startTime.setDate(startTime.getDate()-1);\r\n                }else{\r\n                    startTime=startTime.getTime();\r\n                }\r\n            }\r\n            \r\n            startTime=new Date(startTime).getTime();\r\n            entityId=self.ctx.defaultSubscription.datasources[0].entityId;\r\n            // entityId='037c3cf0-8977-11ec-b586-f5145429eb39';\r\n            let req=self.ctx.http.post(url, { 'start_ts': startTime, 'end_ts': new Date().getTime(), 'entity_id': entityId}, {headers:{\"Content-Type\":\"application/json\",\"X-Authorization\":\"Bearer \"+token}});\r\n            req.subscribe(res=>{\r\n                res.forEach(dt=>{\r\n                    value += dt.net_kwh;\r\n                });\r\n                var txtValue;\r\n                if (isNumber(value)) {\r\n                    var decimals = self.ctx.decimals;\r\n                    var units = self.ctx.units;\r\n                    if (self.ctx.datasources.length > 0 && self.ctx.datasources[0].dataKeys.length > 0) {\r\n                        dataKey = self.ctx.datasources[0].dataKeys[0];\r\n                        if (dataKey.decimals || dataKey.decimals === 0) {\r\n                            decimals = dataKey.decimals;\r\n                        }\r\n                        if (dataKey.units) {\r\n                            units = dataKey.units;\r\n                        }\r\n                    }\r\n                    txtValue = self.ctx.utils.formatValue(value, decimals, units, true);\r\n                    \r\n                    if(self.ctx.settings.numberWithCommas){\r\n                        txtValue = txtValue.split(' ');\r\n                        txtValue[0] = numberWithCommas(txtValue[0]);\r\n                        txtValue = txtValue.join(' ');\r\n                    }\r\n                    \r\n                    \r\n                } else {\r\n                    txtValue = value;\r\n                }\r\n                self.ctx.valueCell.html(txtValue);\r\n                var targetWidth;\r\n                var minDelta;\r\n                if (self.ctx.labelPosition === 'left') {\r\n                    targetWidth = self.ctx.datasourceContainer.width() - self.ctx.labelCell.width();\r\n                    minDelta = self.ctx.width/16 + self.ctx.padding;\r\n                } else {\r\n                    targetWidth = self.ctx.datasourceContainer.width();\r\n                    minDelta = self.ctx.padding;\r\n                }\r\n                var delta = targetWidth - self.ctx.valueCell.textWidth();\r\n                var fontSize = self.ctx.valueFontSize;\r\n                if (targetWidth > minDelta) {\r\n                    while (delta < minDelta && fontSize > 6) {\r\n                        fontSize--;\r\n                        self.ctx.valueCell.css('font-size', fontSize+'px');\r\n                        delta = targetWidth - self.ctx.valueCell.textWidth();\r\n                    }\r\n                }\r\n                \r\n            });\r\n        }\r\n    }    \r\n    \r\n};\r\n\r\nself.onResize = function() {\r\n    var labelFontSize;\r\n    if (self.ctx.labelPosition === 'top') {\r\n        self.ctx.padding = self.ctx.height/20;\r\n        labelFontSize = self.ctx.height/4;\r\n        self.ctx.valueFontSize = self.ctx.height/2;\r\n    } else {\r\n        self.ctx.padding = self.ctx.width/50;\r\n        labelFontSize = self.ctx.height/2.5;\r\n        self.ctx.valueFontSize = self.ctx.height/2;\r\n        if (self.ctx.width/self.ctx.height <= 2.7) {\r\n            labelFontSize = self.ctx.width/7;\r\n            self.ctx.valueFontSize = self.ctx.width/6;\r\n        }\r\n    }\r\n    self.ctx.padding = Math.min(12, self.ctx.padding);\r\n    \r\n    if (self.ctx.labelCell) {\r\n        self.ctx.labelCell.css('font-size', labelFontSize+'px');\r\n        self.ctx.labelCell.css('padding', self.ctx.padding+'px');\r\n    }\r\n    if (self.ctx.valueCell) {\r\n        self.ctx.valueCell.css('font-size', self.ctx.valueFontSize+'px');\r\n        self.ctx.valueCell.css('padding', self.ctx.padding+'px');\r\n    }    \r\n};\r\n\r\nself.typeParameters = function() {\r\n    return {\r\n        maxDatasources: 1,\r\n        maxDataKeys: 1,\r\n        singleEntity: true\r\n    };\r\n};\r\n\r\n\r\nself.onDestroy = function() {\r\n};",
        "settingsSchema": "{\r\n    \"schema\": {\r\n        \"type\": \"object\",\r\n        \"title\": \"Settings\",\r\n        \"properties\": {\r\n            \"labelPosition\": {\r\n                \"title\": \"Label position\",\r\n                \"type\": \"string\",\r\n                \"default\": \"left\"\r\n            },\r\n            \"numberWithCommas\": {\r\n                \"title\": \"Number with Commas\",\r\n                \"type\": \"boolean\",\r\n                \"default\": false\r\n            },\r\n            \"durationType\": {\r\n                \"title\": \"Duration type\",\r\n                \"type\": \"string\",\r\n                \"default\": \"today\"\r\n            },\r\n            \"apiEndpoint\": {\r\n                \"title\": \"API Endpoint\",\r\n                \"type\": \"string\",\r\n                \"default\": \"/nrdapi/get_monthly_kwh\"\r\n            },\r\n            \"defaultStartTime\": {\r\n                \"title\": \"Default Start Time (00:00:00 to 23:59:59)\",\r\n                \"type\": \"string\",\r\n                \"default\": \"06:00:00\"\r\n            }\r\n        },\r\n        \"required\": [\"durationType\"]\r\n    },\r\n    \"form\": [\r\n        {\r\n           \"key\": \"labelPosition\",\r\n           \"type\": \"rc-select\",\r\n           \"multiple\": false,\r\n           \"items\": [\r\n               {\r\n                   \"value\": \"left\",\r\n                   \"label\": \"Left\"\r\n               },\r\n               {\r\n                   \"value\": \"top\",\r\n                   \"label\": \"Top\"\r\n               }\r\n            ]\r\n        },\r\n        {\r\n            \"key\": \"numberWithCommas\",\r\n            \"type\": \"checkbox\"\r\n        },\r\n        {\r\n            \"key\": \"durationType\",\r\n            \"type\": \"select\",\r\n            \"titleMap\": [\r\n                {\r\n                    \"name\": \"Today\",\r\n                    \"value\": \"today\"\r\n                },\r\n                {\r\n                    \"name\": \"This Month\",\r\n                    \"value\": \"thisMonth\"\r\n                },\r\n                {\r\n                    \"name\": \"This Year\",\r\n                    \"value\": \"thisYear\"\r\n                }\r\n            ]\r\n        },\r\n        {\r\n            \"key\": \"apiEndpoint\",\r\n            \"type\": \"text\"\r\n        },\r\n        \"defaultStartTime\"\r\n    ]\r\n}",
        "dataKeySettingsSchema": "{}\n",
        "defaultConfig": "{\"datasources\":[{\"type\":\"function\",\"name\":\"function\",\"entityAliasId\":null,\"filterId\":null,\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Consumed\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\",\"units\":\"kWh\",\"decimals\":2,\"usePostProcessing\":null,\"postFuncBody\":null}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"#111111\",\"color\":\"#ffffff\",\"padding\":\"8px\",\"settings\":{\"labelPosition\":\"top\",\"durationType\":\"today\",\"numberWithCommas\":true,\"apiEndpoint\":\"/nrdapi/get_monthly_kwh\",\"defaultStartTime\":\"06:00:00\"},\"title\":\"Consumed WHD\",\"showTitleIcon\":false,\"iconColor\":\"rgba(0, 0, 0, 0.87)\",\"iconSize\":\"24px\",\"titleTooltip\":\"\",\"dropShadow\":false,\"enableFullscreen\":false,\"widgetStyle\":{},\"titleStyle\":{\"fontSize\":\"16px\",\"fontWeight\":400},\"showLegend\":false}"
      }
    },
    {
      "alias": "api_test",
      "name": "api_test",
      "image": null,
      "description": null,
      "descriptor": {
        "type": "static",
        "sizeX": 7.5,
        "sizeY": 3,
        "resources": [],
        "templateHtml": "",
        "templateCss": "",
        "controllerScript": "self.onInit = function() {\n\nlet http = {\n    method: self.ctx.http,\n    baseUrl: \"/nrdapi/\",\n    config: {\n        headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-Authorization\": \"Bearer \" +\n                localStorage.getItem(\n                    'jwt_token')\n        }\n    }\n};\n\nlet postData = {\n    \"end_ts\": 1645509151160,\n    \"start_ts\": 1645488000000\n};\n\n\nhttp.method.post(http.baseUrl + \"energy_report_df\", postData, http.config).subscribe(function(res){\n    console.log(res);\n});\n    \n    \n    \n}\n\nself.actionSources = function() {\n    return {\n        'elementClick': {\n            name: 'widget-action.element-click',\n            multiple: true\n        }\n    };\n}\n\nself.onDestroy = function() {\n}\n",
        "settingsSchema": "{\n    \"schema\": {\n        \"type\": \"object\",\n        \"title\": \"Settings\",\n        \"required\": [\"cardHtml\"],\n        \"properties\": {\n            \"cardCss\": {\n                \"title\": \"CSS\",\n                \"type\": \"string\",\n                \"default\": \".card {\\n font-weight: bold; \\n}\"\n            },\n            \"cardHtml\": {\n                \"title\": \"HTML\",\n                \"type\": \"string\",\n                \"default\": \"<div class='card'>HTML code here</div>\"\n            }\n        }\n    },\n    \"form\": [\n        {\n            \"key\": \"cardCss\",\n            \"type\": \"css\"\n        },           \n        {\n            \"key\": \"cardHtml\",\n            \"type\": \"html\"\n        }    \n    ]\n}",
        "dataKeySettingsSchema": "{}\n",
        "defaultConfig": "{\"datasources\":[{\"type\":\"static\",\"name\":\"function\",\"dataKeys\":[{\"name\":\"f(x)\",\"type\":\"function\",\"label\":\"Random\",\"color\":\"#2196f3\",\"settings\":{},\"_hash\":0.15479322438769105,\"funcBody\":\"var value = prevValue + Math.random() * 100 - 50;\\nvar multiplier = Math.pow(10, 2 || 0);\\nvar value = Math.round(value * multiplier) / multiplier;\\nif (value < -1000) {\\n\\tvalue = -1000;\\n} else if (value > 1000) {\\n\\tvalue = 1000;\\n}\\nreturn value;\"}]}],\"timewindow\":{\"realtime\":{\"timewindowMs\":60000}},\"showTitle\":false,\"backgroundColor\":\"rgb(255, 255, 255)\",\"color\":\"rgba(0, 0, 0, 0.87)\",\"padding\":\"8px\",\"settings\":{\"cardHtml\":\"<div class='card'>HTML code here</div>\",\"cardCss\":\".card {\\n    font-weight: bold;\\n    font-size: 32px;\\n    color: #999;\\n    width: 100%;\\n    height: 100%;\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n}\"},\"title\":\"api_test\",\"dropShadow\":true}"
      }
    }
  ]
}